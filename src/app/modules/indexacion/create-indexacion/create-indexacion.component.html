<!--begin::Modal content-->
<div class="modal-content">
  <!--begin::Modal header-->
  <div class="modal-header" id="kt_modal_add_user_header">
    <h5 class="modal-title">Agregar Documento  Módulo #{{ idModulo }}</h5>
    <div class="btn btn-sm btn-icon btn-active-color-primary" (click)="close()" style="cursor:pointer">
      <i class="fas fa-times"></i>
    </div>
  </div>
  <!--end::Modal header-->

  <!--begin::Modal body-->
  <div class="modal-body py-10 px-lg-17">
    <form class="form">
      <div class="row g-5">
         <!-- Columna 1 -->
      <div class="col-md-6">
        <!-- Botón Agregar -->
        <div class="mb-3">
          <button type="button" class="btn btn-sm btn-secondary" (click)="agregarCampo()">Agregar Parámetros</button>
        </div>

        <!-- Campos dinámicos -->
        <div *ngFor="let campo of campos; let i = index" class="mb-2 d-flex align-items-center gap-2">
          <!-- Título del campo -->
          <input
            type="text"
            class="form-control"
            [(ngModel)]="campo.titulo"
            [name]="'titulo_' + i"
            placeholder="Ej: Nombre, Apellido, Título"
            style="width: 40%;"
          />

          <!-- Valor del campo (editable) -->
          <input
            type="text"
            class="form-control"
            [(ngModel)]="campo.valor"
            [name]="'valor_' + i"
            [readonly]="inputSeleccionadoIndex !== i"
            (click)="seleccionarInput(i)"
            placeholder="Ingrese valor o seleccione del PDF"
            style="width: 50%;"
          />

          <!-- Botón eliminar -->
          <button
            type="button"
            class="btn btn-icon btn-sm btn-danger"
            (click)="eliminarCampo(i)"
            title="Eliminar campo"
          >
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>
      </div>

      <!-- Columna 2 -->
      <div class="col-md-6">
        <div class="fv-row mb-5">
          <label class="form-label">Subir documentos</label>
          <input
            type="file"
            class="form-control"
            (change)="onFileSelectedtemp($event)"
            multiple
            accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
          />
        </div>
        <!-- NUEVO VISOR: Solo para archivos recién cargados -->
        <div *ngIf="archivoSeleccionadoTemp" style="margin-top: 2rem;">
          <h5>Vista previa del archivo cargado</h5>

          <div style="position: relative; width: 100%; max-width: 800px;">
            <canvas #pdfCanvasTemp style="border: 1px solid black; width: 100%;"></canvas>
            
            <div #textLayerTemp class="textLayer"></div>
          </div>

          <div style="margin-top: 1rem;">
            <button (click)="prevPageTemp()" [disabled]="pageNumTemp <= 1">Anterior</button>
            <button (click)="nextPageTemp()" [disabled]="pageNumTemp >= pageCountTemp">Siguiente</button>
            <span>Página {{pageNumTemp}} / {{pageCountTemp}}</span>
          </div>
        </div>


        <div class="mt-2" *ngIf="archivoSeleccionadoTemp">
          <label class="form-label">Archivo seleccionado:</label>
          <div>{{ archivoSeleccionadoTemp.name }}</div>

          <div class="mt-3">
            <button class="btn btn-primary" (click)="procesarArchivos()">Procesar</button>
          </div>
        </div>



        <div style="position: relative; width: 100%; max-width: 800px;">
          <canvas #pdfCanvas style="border: 1px solid black; width: 100%;"></canvas>
          <div #textLayer class="textLayer"></div>
        </div>

        <div style="margin-top: 1rem;">
          <button (click)="prevPage()" [disabled]="pageNum <= 1">Anterior página</button>
          <button (click)="nextPage()" [disabled]="pageNum >= pageCount">Siguiente página</button>
          <span>Página {{pageNum}} / {{pageCount}}</span>
        </div>

        <div *ngIf="archivosProcesados.length > 1" style="margin-top: 1rem;">
          <label>Ver otro PDF:</label>
          <button *ngFor="let archivo of archivosProcesados; let i = index" (click)="verPdfPorIndice(i)">
            {{ archivo.nombre }}
          </button>
        </div>
      </div>
  </div>

      <!-- Botones -->
      <div class="text-end pt-10">
        <button type="button" class="btn btn-light me-3" (click)="close()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="guardar()">
          <span class="indicator-label">Guardar</span>
        </button>
      </div>
    </form>
  </div>
  <!--end::Modal body-->
</div>
<!--end::Modal content-->
