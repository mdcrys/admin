<!--begin::Modal content-->
<div class="modal-content">
  <!--begin::Modal header-->
  <div class="modal-header" id="kt_modal_add_user_header">
    <h5 class="modal-title">Agregar Documento  MÃ³dulo #{{ idModulo }}</h5>
    <div class="btn btn-sm btn-icon btn-active-color-primary" (click)="close()" style="cursor:pointer">
      <i class="fas fa-times"></i>
    </div>
  </div>
  <!--end::Modal header-->

  <!--begin::Modal body-->
  <div class="modal-body py-10 px-lg-17">
    <form class="form">
      <div class="row g-5">
         <!-- Columna 1 -->
    <div class="col-md-6">
      <!-- BotÃ³n Agregar -->
      <div class="mb-3">
        <button type="button" class="btn btn-sm btn-secondary" (click)="agregarCampo()">Agregar ParÃ¡metros</button>
      </div>

      <!-- Campos dinÃ¡micos -->
      <div *ngFor="let campo of campos; let i = index" class="mb-2 d-flex align-items-center gap-2">
        <!-- TÃ­tulo del campo -->
        <input
          type="text"
          class="form-control"
          [(ngModel)]="campo.titulo"
          [name]="'titulo_' + i"
          placeholder="Ej: Nombre, Apellido, TÃ­tulo"
          style="width: 40%;"
        />

        <!-- Valor del campo (editable) -->
        <input
          type="text"
          class="form-control"
          [(ngModel)]="campo.valor"
          [name]="'valor_' + i"
          [readonly]="inputSeleccionadoIndex !== i"
          (click)="seleccionarInput(i)"
          placeholder="Ingrese valor o seleccione del PDF"
          style="width: 50%;"
        />

        <!-- BotÃ³n eliminar -->
        <button
          type="button"
          class="btn btn-icon btn-sm btn-danger"
          (click)="eliminarCampo(i)"
          title="Eliminar campo"
        >
          <i class="fas fa-trash-alt"></i>
        </button>
      </div>
    </div>

    <!-- Columna 2 -->
    <div class="col-md-6">
      <div class="fv-row mb-5">
        <label class="form-label">Subir documentos</label>
        <input
          type="file"
          class="form-control"
          (change)="onFileSelected($event)"
          multiple
          accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
        />
      </div>

      <div class="mt-2" *ngIf="archivosSeleccionados.length > 0">
  <label class="form-label">Archivos seleccionados:</label>
  <ul class="list-group">
    <li class="list-group-item py-1 px-2" *ngFor="let archivo of archivosSeleccionados">
      {{ archivo.name }}
    </li>
  </ul>

  <div class="mt-3">
    <button class="btn btn-primary" (click)="procesarArchivos()">Procesar</button>
  </div>
</div>

<!-- ðŸ”½ Mostramos cada PDF con ngx-extended-pdf-viewer -->
<ngx-extended-pdf-viewer [src]="pdfSrc" useBrowserLocale="true" height="600px"></ngx-extended-pdf-viewer>





      <div class="mt-5" *ngIf="archivosProcesados.length > 0">
        <h5>Visualizador de PDFs procesados</h5>
        <div class="d-flex align-items-center justify-content-center">
          <button class="btn btn-light me-3" (click)="anteriorPDF()" [disabled]="indiceActual === 0">â—€</button>

          <!-- PDF iframe -->
          <iframe
            #pdfIframe
            [src]="urlsSanitizadas[indiceActual]"
            width="100%"
            height="500px"
            style="border: 1px solid #ccc;"
          ></iframe>

          <button class="btn btn-light ms-3" (click)="siguientePDF()" [disabled]="indiceActual === archivosProcesados.length - 1">â–¶</button>
        </div>
        <p class="text-center mt-2">PDF {{ indiceActual + 1 }} de {{ archivosProcesados.length }}</p>

        <!-- Input para texto seleccionado -->
        <div class="mb-3" *ngIf="textoSeleccionado && textoSeleccionado.length > 0">
          <label class="form-label">Texto Seleccionado</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="textoSeleccionado"
            placeholder="Texto seleccionado"
          />
        </div>
      </div>
    </div>

          
        <!-- MenÃº contextual -->
        <div
          #contextMenu
          [style.display]="showMenu ? 'block' : 'none'"
          [style.left.px]="menuX"
          [style.top.px]="menuY"
          style="position: absolute; z-index: 9999; background: white; border: 1px solid #ccc; padding: 5px; border-radius: 4px; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); cursor: pointer;"
          (click)="seleccionarTexto()"
        >
          ðŸ“‹ Seleccionar
        </div>
      </div>

      <!-- Botones -->
      <div class="text-end pt-10">
        <button type="button" class="btn btn-light me-3" (click)="close()">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="guardar()">
          <span class="indicator-label">Guardar</span>
        </button>
      </div>
    </form>
  </div>
  <!--end::Modal body-->
</div>
<!--end::Modal content-->
