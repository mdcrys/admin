"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[674],{9674:(C,p,i)=>{i.r(p),i.d(p,{MasivoModule:()=>S});var u=i(6814),d=i(7304),t=i(5879);let v=(()=>{class s{static \u0275fac=function(o){return new(o||s)};static \u0275cmp=t.Xpm({type:s,selectors:[["app-masivo"]],decls:1,vars:0,template:function(o,r){1&o&&t._UZ(0,"router-outlet")},dependencies:[d.lC]})}return s})();var a=i(9862),g=i(4716),f=i(5619),c=i(6988),m=i(3595);let b=(()=>{class s{http;authservice;isLoading$;isLoadingSubject;constructor(e,o){this.http=e,this.authservice=o,this.isLoadingSubject=new f.X(!1),this.isLoading$=this.isLoadingSubject.asObservable()}desunirPdf(e){this.isLoadingSubject.next(!0);const o=new a.WM({Authorization:"Bearer "+this.authservice.token}),r=new FormData;return r.append("archivo_pdf",e),this.http.post(c.$g+"/desunir_pdf",r,{headers:o,responseType:"blob"}).pipe((0,g.x)(()=>this.isLoadingSubject.next(!1)))}iniciarProceso(e){const o=new a.WM({Authorization:"Bearer "+this.authservice.token}),r=new FormData;return r.append("archivo_pdf",e),this.http.post(c.$g+"/iniciar_proceso_pdf",r,{headers:o})}obtenerProgreso(e){const o=new a.WM({Authorization:"Bearer "+this.authservice.token});return this.http.get(c.$g+`/progreso_pdf/${e}`,{headers:o})}descargarZip(e){const o=new a.WM({Authorization:"Bearer "+this.authservice.token});return this.http.get(c.$g+`/descargar_pdf/${e}`,{headers:o,responseType:"blob"})}static \u0275fac=function(o){return new(o||s)(t.LFG(a.eN),t.LFG(m.e8))};static \u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var L=i(2425);function j(s,I){if(1&s&&(t.TgZ(0,"div")(1,"p"),t._uU(2),t.qZA()()),2&s){const e=t.oxw();t.xp6(2),t.hij("Cargando... ",e.progress,"%")}}const F=[{path:"",component:v,children:[{path:"ver",component:(()=>{class s{masivoService;toast;selectedFile;isLoading=!1;progress=0;jobId;constructor(e,o){this.masivoService=e,this.toast=o}onFileSelected(e){this.selectedFile=e.target.files[0]}subirYDesunir(){this.selectedFile?(this.isLoading=!0,this.progress=0,this.masivoService.iniciarProceso(this.selectedFile).subscribe({next:e=>{this.jobId=e.jobId,this.verificarProgreso()},error:()=>{this.isLoading=!1,this.toast.error("Error","No se pudo iniciar el proceso")}})):alert("Selecciona un archivo PDF primero.")}verificarProgreso(){if(console.log("verificarProgreso llamado, jobId:",this.jobId),!this.jobId)return console.log("No hay jobId, deteniendo proceso"),void(this.isLoading=!1);this.masivoService.obtenerProgreso(this.jobId).subscribe({next:e=>{console.log("Respuesta obtenerProgreso:",e),this.progress=e.paginas_procesadas/e.total_paginas*100,"finalizado"===e.estado&&e.zipUrl?(this.isLoading=!1,this.toast.success("Proceso terminado","PDF separado con \xe9xito"),this.masivoService.descargarZip(this.jobId).subscribe({next:o=>{const r=window.URL.createObjectURL(o),n=document.createElement("a");n.href=r,n.download="paginas_separadas.zip",document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r),console.log("Descarga iniciada")},error:o=>{console.error("Error al descargar zip:",o),this.toast.error("Error","No se pudo descargar el archivo zip")}})):(console.log("Proceso no terminado, volver a consultar en 5 segundos"),setTimeout(()=>this.verificarProgreso(),5e3))},error:e=>{console.error("Error al consultar progreso:",e),this.isLoading=!1,this.toast.error("Error","Error al consultar progreso")}})}static \u0275fac=function(o){return new(o||s)(t.Y36(b),t.Y36(L._W))};static \u0275cmp=t.Xpm({type:s,selectors:[["app-ver-masivo"]],decls:4,vars:1,consts:[["type","file","accept",".pdf",3,"change"],[3,"click"],[4,"ngIf"]],template:function(o,r){1&o&&(t.TgZ(0,"input",0),t.NdJ("change",function(z){return r.onFileSelected(z)}),t.qZA(),t.TgZ(1,"button",1),t.NdJ("click",function(){return r.subirYDesunir()}),t._uU(2,"Subir y Desunir PDF"),t.qZA(),t.YNc(3,j,3,1,"div",2)),2&o&&(t.xp6(3),t.Q6J("ngIf",r.isLoading))},dependencies:[u.O5]})}return s})()}]}];let M=(()=>{class s{static \u0275fac=function(o){return new(o||s)};static \u0275mod=t.oAB({type:s});static \u0275inj=t.cJS({imports:[d.Bz.forChild(F),d.Bz]})}return s})();var h=i(6223),l=i(1274),y=i(53);let S=(()=>{class s{static \u0275fac=function(o){return new(o||s)};static \u0275mod=t.oAB({type:s});static \u0275inj=t.cJS({imports:[u.ez,M,a.JF,h.u5,l.IJ,h.UX,y.vi,l.bz,l.jF]})}return s})()}}]);