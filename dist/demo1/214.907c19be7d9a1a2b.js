"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[214],{7214:(q,L,l)=>{l.r(L),l.d(L,{ProformasModule:()=>bt});var u=l(6814),b=l(7304),e=l(5879);let M=(()=>{class i{static \u0275fac=function(o){return new(o||i)};static \u0275cmp=e.Xpm({type:i,selectors:[["app-proformas"]],decls:1,vars:0,template:function(o,n){1&o&&e._UZ(0,"router-outlet")},dependencies:[b.lC]})}return i})();var O=l(3113),A=l(9860),x=l(224),E=l(9756),T=l(2438),C=l(3620),m=l(1274),P=l(2425),g=l(9862),v=l(5619),f=l(4716),h=l(6988),y=l(3595);let D=(()=>{class i{http;authservice;isLoading$;isLoadingSubject;constructor(t,o){this.http=t,this.authservice=o,this.isLoadingSubject=new v.X(!1),this.isLoading$=this.isLoadingSubject.asObservable()}searchClients(t,o,n){this.isLoadingSubject.next(!0);let r="";t&&(r+="&n_document="+t),o&&(r+="&full_name="+o),n&&(r+="&phone="+n);let a=h.$g+"/proformas/search-clients?p=1"+r,_=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.get(a,{headers:_}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}searchProducts(t){this.isLoadingSubject.next(!0);let o="";t&&(o+="&search="+t);let n=h.$g+"/proformas/search-products?p=1"+o,r=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.get(n,{headers:r}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}configAll(){this.isLoadingSubject.next(!0);let t=h.$g+"/proformas/config",o=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.get(t,{headers:o}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}listProformas(t=1,o={}){this.isLoadingSubject.next(!0);let n=h.$g+"/proformas/index",r=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.post(n,o,{headers:r}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}showProforma(t){this.isLoadingSubject.next(!0);let o=h.$g+"/proformas/"+t,n=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.get(o,{headers:n}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}evalDisponibilidad(t,o,n){this.isLoadingSubject.next(!0);let r=h.$g+"/proformas/eval-disponibilidad/"+t+"?unit_id="+o+"&quantity="+n,a=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.get(r,{headers:a}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}createProforma(t){this.isLoadingSubject.next(!0);let o=h.$g+"/proformas",n=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.post(o,t,{headers:n}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}editProforma(t,o){this.isLoadingSubject.next(!0);let n=h.$g+"/proformas/"+t,r=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.post(n,o,{headers:r}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}deleteProforma(t){this.isLoadingSubject.next(!0);let o=h.$g+"/proformas/"+t,n=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.delete(o,{headers:n}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}addDetailProforma(t){this.isLoadingSubject.next(!0);let o=h.$g+"/proforma-details",n=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.post(o,t,{headers:n}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}editDetailProforma(t,o){this.isLoadingSubject.next(!0);let n=h.$g+"/proforma-details/"+t,r=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.put(n,o,{headers:r}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}deleteDetailProforma(t){this.isLoadingSubject.next(!0);let o=h.$g+"/proforma-details/"+t,n=new g.WM({Authorization:"Bearer "+this.authservice.token});return this.http.delete(o,{headers:n}).pipe((0,f.x)(()=>this.isLoadingSubject.next(!1)))}static \u0275fac=function(o){return new(o||i)(e.LFG(g.eN),e.LFG(y.e8))};static \u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var c=l(6223);const k=["discount"];function J(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",31),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function w(i,s){if(1&i&&(e.ynx(0),e.YNc(1,J,3,2,"ng-container",18),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.PRODUCT_SELECTED.units)}}function F(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"select",29),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.unidad_product=n)})("change",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.changeUnitProduct(n))}),e.TgZ(1,"option",17),e._uU(2,"Selec. Unidad"),e.qZA(),e.YNc(3,w,2,1,"ng-container",30),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.unidad_product),e.xp6(3),e.Q6J("ngIf",t.PRODUCT_SELECTED)}}function Q(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",31),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.AsE("",t.warehouse.name," (",t.quantity,")")}}function Y(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",19)(1,"input",32,33),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.amount_discount=n)}),e.qZA(),e.TgZ(3,"small"),e._uU(4,"Descuento del producto"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.amount_discount)}}function B(i,s){1&i&&(e.TgZ(0,"span",34),e._uU(1,"No hay de esa unidad disponible en ninguna sucursal"),e.qZA())}function j(i,s){1&i&&(e.TgZ(0,"span",34),e._uU(1,"No hay de esa unidad disponible en nuestra sucursal"),e.qZA())}function V(i,s){1&i&&e._UZ(0,"span",35)}let S=(()=>{class i{modal;toast;proformaService;DETAIL_PRODUCT;sucursale_asesor;CLIENT_SELECTED;PROFORMA_ID;EditProductProforma=new e.vpe;price=0;description_product="";quantity_product=0;unidad_product="";almacen_product="";PRODUCT_SELECTED;loadUnidad=!1;warehouses_product=[];exits_warehouse=[];amount_discount=0;source;something;isLoading$;constructor(t,o,n){this.modal=t,this.toast=o,this.proformaService=n}ngOnInit(){this.isLoading$=this.proformaService.isLoading$,this.PRODUCT_SELECTED=this.DETAIL_PRODUCT.product,this.price=this.DETAIL_PRODUCT.price_unit,this.description_product=this.DETAIL_PRODUCT.description,this.quantity_product=this.DETAIL_PRODUCT.quantity,this.unidad_product=this.DETAIL_PRODUCT.unidad_product,this.warehouses_product=this.PRODUCT_SELECTED.warehouses.filter(t=>t.unit.id==this.unidad_product),this.exits_warehouse=this.warehouses_product.filter(t=>t.warehouse.sucursale_id==this.sucursale_asesor),this.amount_discount=this.DETAIL_PRODUCT.discount,setTimeout(()=>{2==this.PRODUCT_SELECTED.is_discount&&this.initKeyUpDiscount()},50)}initKeyUpDiscount(){this.source=(0,T.R)(this.something.nativeElement,"keyup"),this.source.pipe((0,C.b)(1200)).subscribe(t=>{console.log(t),this.verifiedDiscount()})}isLoadingProcess(){this.proformaService.isLoadingSubject.next(!0),setTimeout(()=>{this.proformaService.isLoadingSubject.next(!1)},50)}changeUnitProduct(t){console.log(t.target.value);let o=t.target.value;this.warehouses_product=this.PRODUCT_SELECTED.warehouses.filter(d=>d.unit.id==o),this.exits_warehouse=this.warehouses_product.filter(d=>d.warehouse.sucursale_id==this.sucursale_asesor);let n=this.PRODUCT_SELECTED.wallets;setTimeout(()=>{this.verifiedDiscount()},50);let r=n.filter(d=>d.unit&&d.sucursale&&d.client_segment),a=r.find(d=>d.unit.id==o&&d.sucursale.id==this.sucursale_asesor&&d.client_segment.id==this.CLIENT_SELECTED.client_segment.id);if(a)return void(this.price=a.price_general);r=n.filter(d=>d.unit&&d.sucursale&&!d.client_segment);let _=r.find(d=>d.unit.id==o&&d.sucursale.id==this.sucursale_asesor&&null==d.client_segment);r=n.filter(d=>d.unit&&!d.sucursale&&d.client_segment);let p=r.find(d=>d.unit.id==o&&null==d.sucursale&&d.client_segment.id==this.CLIENT_SELECTED.client_segment.id);if(_&&p)return void(this.price=_.price_general<p.price_general?_.price_general:p.price_general);if(_)return void(this.price=_.price_general);if(p)return void(this.price=p.price_general);let Z=n.find(d=>d.unit.id==o&&null==d.sucursale&&null==d.client_segment);this.price=Z?Z.price_general:this.PRODUCT_SELECTED.price_general}verifiedDiscount(){return console.log(this.amount_discount),this.amount_discount>.01*this.PRODUCT_SELECTED.max_discount*this.price?(this.toast.error("VALIDACI\xd3N","EL DESCUENTO SUPERA EL MONTO QUE TIENE CONFIGURADO"),void(this.amount_discount=0)):this.amount_discount<.01*this.PRODUCT_SELECTED.min_discount*this.price?(this.toast.error("VALIDACI\xd3N","EL DESCUENTO NO SUPERA EL MONTO QUE TIENE CONFIGURADO"),void(this.amount_discount=0)):void 0}edit(){let t=this.price-this.amount_discount,o=t*(.01*this.PRODUCT_SELECTED.importe_iva),n=this.PRODUCT_SELECTED.units.find(r=>r.id==this.unidad_product);this.DETAIL_PRODUCT.quantity=this.quantity_product,this.DETAIL_PRODUCT.UNIDAD=n,this.DETAIL_PRODUCT.unidad_product=this.unidad_product,this.DETAIL_PRODUCT.impuesto=o,this.DETAIL_PRODUCT.description=this.description_product,this.DETAIL_PRODUCT.discount=this.amount_discount,this.DETAIL_PRODUCT.subtotal=t,this.DETAIL_PRODUCT.total=(t+o)*this.quantity_product,this.PROFORMA_ID?this.proformaService.editDetailProforma(this.DETAIL_PRODUCT.id,this.DETAIL_PRODUCT).subscribe(r=>{console.log(r),this.EditProductProforma.emit(r),this.modal.close()}):(this.EditProductProforma.emit(this.DETAIL_PRODUCT),this.modal.close())}static \u0275fac=function(o){return new(o||i)(e.Y36(m.Kz),e.Y36(P._W),e.Y36(D))};static \u0275cmp=e.Xpm({type:i,selectors:[["app-edit-product-detail-proforma"]],viewQuery:function(o,n){if(1&o&&e.Gf(k,5),2&o){let r;e.iGM(r=e.CRH())&&(n.something=r.first)}},inputs:{DETAIL_PRODUCT:"DETAIL_PRODUCT",sucursale_asesor:"sucursale_asesor",CLIENT_SELECTED:"CLIENT_SELECTED",PROFORMA_ID:"PROFORMA_ID"},outputs:{EditProductProforma:"EditProductProforma"},decls:43,vars:13,consts:[[1,"modal-content"],["id","kt_modal_add_user_header",1,"modal-header"],[1,"fw-bolder"],["data-kt-users-modal-action","close",1,"btn","btn-icon","btn-sm","btn-active-icon-primary",3,"click"],[1,"svg-icon","svg-icon-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none"],["opacity","0.5","x","6","y","17.3137","width","16","height","2","rx","1","transform","rotate(-45 6 17.3137)","fill","currentColor"],["x","7.41422","y","6","width","16","height","2","rx","1","transform","rotate(45 7.41422 6)","fill","currentColor"],[1,"modal-body","scroll-y","mx-5","my-7"],["id","kt_modal_add_user_form","action","#",1,"form"],["id","kt_modal_add_user_scroll","data-kt-scroll","true","data-kt-scroll-activate","{default: false, lg: true}","data-kt-scroll-max-height","auto","data-kt-scroll-dependencies","#kt_modal_add_user_header","data-kt-scroll-wrappers","#kt_modal_add_user_scroll","data-kt-scroll-offset","300px",1,"d-flex","flex-column","scroll-y","me-n7","pe-7"],[1,"fv-row","row","mb-7"],[1,"col-6"],["type","number","disabled","","name","price","placeholder","Precio",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["type","number","name","quantity_product","placeholder","Cantidad",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["class","form-control form-select-solid fw-bolder","name","unidad_product","placeholder","Selec. Unidad",3,"ngModel","ngModelChange","change",4,"ngIf"],["name","almacen_product","placeholder","Selec. Almacen",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange"],["value",""],[4,"ngFor","ngForOf"],[1,"col-6","mt-2"],["rows","3","name","description_product","placeholder","Nota",1,"form-control","form-control-solid",3,"ngModel","ngModelChange"],["class","col-6 mt-2",4,"ngIf"],[1,"col-12"],["class","text-danger",4,"ngIf"],[1,"text-center","pt-15"],["type","reset",1,"btn","btn-light","me-3",3,"click"],["type","button","data-kt-users-modal-action","submit",1,"btn","btn-primary",3,"click"],[1,"indicator-label"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],["name","unidad_product","placeholder","Selec. Unidad",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange","change"],[4,"ngIf"],[3,"value"],["type","number","name","amount_discount","placeholder","Descuento",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["discount",""],[1,"text-danger"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e.NdJ("click",function(){return n.modal.dismiss()}),e.TgZ(5,"span",4),e.O4$(),e.TgZ(6,"svg",5),e._UZ(7,"rect",6)(8,"rect",7),e.qZA()()()(),e.kcU(),e.TgZ(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"input",13),e.NdJ("ngModelChange",function(a){return n.price=a}),e.qZA(),e.TgZ(15,"small"),e._uU(16,"Precio del producto"),e.qZA()(),e.TgZ(17,"div",12)(18,"input",14),e.NdJ("ngModelChange",function(a){return n.quantity_product=a}),e.qZA(),e.TgZ(19,"small"),e._uU(20,"Cantidad del producto"),e.qZA()(),e.TgZ(21,"div",12),e.YNc(22,F,4,2,"select",15),e.qZA(),e.TgZ(23,"div",12)(24,"select",16),e.NdJ("ngModelChange",function(a){return n.almacen_product=a}),e.TgZ(25,"option",17),e._uU(26,"Selec. Almacen"),e.qZA(),e.YNc(27,Q,3,3,"ng-container",18),e.qZA()(),e.TgZ(28,"div",19)(29,"textarea",20),e.NdJ("ngModelChange",function(a){return n.description_product=a}),e.qZA()(),e.YNc(30,Y,5,1,"div",21),e.TgZ(31,"div",22),e.YNc(32,B,2,0,"span",23),e._UZ(33,"br"),e.YNc(34,j,2,0,"span",23),e.qZA()()(),e.TgZ(35,"div",24)(36,"button",25),e.NdJ("click",function(){return n.modal.dismiss()}),e._uU(37,"Cerrar"),e.qZA(),e.TgZ(38,"button",26),e.NdJ("click",function(){return n.edit()}),e.TgZ(39,"span",27),e._uU(40,"Editar"),e.qZA(),e.YNc(41,V,1,0,"span",28),e.ALo(42,"async"),e.qZA()()()()()),2&o&&(e.xp6(3),e.hij("Edit Product Detail: ",n.DETAIL_PRODUCT.product.title,""),e.xp6(11),e.Q6J("ngModel",n.price),e.xp6(4),e.Q6J("ngModel",n.quantity_product),e.xp6(4),e.Q6J("ngIf",!n.loadUnidad),e.xp6(2),e.Q6J("ngModel",n.almacen_product),e.xp6(3),e.Q6J("ngForOf",n.warehouses_product),e.xp6(2),e.Q6J("ngModel",n.description_product),e.xp6(1),e.Q6J("ngIf",n.PRODUCT_SELECTED&&2==n.PRODUCT_SELECTED.is_discount),e.xp6(2),e.Q6J("ngIf",n.unidad_product&&0==n.warehouses_product.length),e.xp6(2),e.Q6J("ngIf",n.unidad_product&&n.warehouses_product.length>0&&0==n.exits_warehouse.length),e.xp6(7),e.Q6J("ngIf",e.lcZ(42,11,n.isLoading$)))},dependencies:[u.sg,u.O5,c._Y,c.YN,c.Kr,c.Fj,c.wV,c.EJ,c.JJ,c.JL,c.On,c.F,u.Ov]})}return i})();function G(i,s){1&i&&e._UZ(0,"span",15)}let U=(()=>{class i{modal;toast;proformaService;DeleteProductProforma=new e.vpe;DETAIL_PRODUCT;PROFORMA_ID;isLoading;constructor(t,o,n){this.modal=t,this.toast=o,this.proformaService=n}ngOnInit(){}delete(){this.PROFORMA_ID?this.proformaService.deleteDetailProforma(this.DETAIL_PRODUCT.id).subscribe(t=>{this.DeleteProductProforma.emit(t),this.modal.close()}):(this.DeleteProductProforma.emit(""),this.modal.close())}static \u0275fac=function(o){return new(o||i)(e.Y36(m.Kz),e.Y36(P._W),e.Y36(D))};static \u0275cmp=e.Xpm({type:i,selectors:[["app-delete-product-detail-proforma"]],inputs:{DETAIL_PRODUCT:"DETAIL_PRODUCT",PROFORMA_ID:"PROFORMA_ID"},outputs:{DeleteProductProforma:"DeleteProductProforma"},decls:21,vars:4,consts:[[1,"modal-content"],["id","kt_modal_add_user_header",1,"modal-header"],[1,"fw-bolder"],["data-kt-users-modal-action","close",1,"btn","btn-icon","btn-sm","btn-active-icon-primary",3,"click"],[1,"svg-icon","svg-icon-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none"],["opacity","0.5","x","6","y","17.3137","width","16","height","2","rx","1","transform","rotate(-45 6 17.3137)","fill","currentColor"],["x","7.41422","y","6","width","16","height","2","rx","1","transform","rotate(45 7.41422 6)","fill","currentColor"],[1,"modal-body","scroll-y","mx-5","mx-xl-15","my-7"],["id","kt_modal_add_user_form","action","#",1,"form"],[1,"text-center","pt-15"],["type","reset",1,"btn","btn-light","me-3",3,"click"],["type","button","data-kt-users-modal-action","submit",1,"btn","btn-danger",3,"click"],[1,"indicator-label"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e.NdJ("click",function(){return n.modal.dismiss()}),e.TgZ(5,"span",4),e.O4$(),e.TgZ(6,"svg",5),e._UZ(7,"rect",6)(8,"rect",7),e.qZA()()()(),e.kcU(),e.TgZ(9,"div",8)(10,"form",9)(11,"p"),e._uU(12," \xbfESTAS SEGURO DE ELIMINAR ESTE PRODUCTO? "),e.qZA(),e.TgZ(13,"div",10)(14,"button",11),e.NdJ("click",function(){return n.modal.dismiss()}),e._uU(15,"Cerrar"),e.qZA(),e.TgZ(16,"button",12),e.NdJ("click",function(){return n.delete()}),e.TgZ(17,"span",13),e._uU(18,"ELIMINAR"),e.qZA(),e.YNc(19,G,1,0,"span",14),e.ALo(20,"async"),e.qZA()()()()()),2&o&&(e.xp6(3),e.hij("Delete Product : #",n.DETAIL_PRODUCT.product.title,""),e.xp6(16),e.Q6J("ngIf",e.lcZ(20,2,n.isLoading)))},dependencies:[u.O5,c._Y,c.JL,c.F,u.Ov]})}return i})();var R=l(1581),I=l(7954),N=l(2262);const z=["discount"];function K(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",91),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function H(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",91),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function $(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",10)(1,"select",92),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.banco_id=n)}),e.TgZ(2,"option",15),e._uU(3,"Selec. Banco"),e.qZA(),e.YNc(4,H,3,2,"ng-container",16),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.banco_id),e.xp6(3),e.Q6J("ngForOf",t.METHOD_PAYMENT_SELECTED.bancos)}}function W(i,s){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"img",93),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.imagen_previzualiza,e.LSH)}}function X(i,s){1&i&&e._UZ(0,"span",94)}function ee(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",91),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function te(i,s){if(1&i&&(e.ynx(0),e.YNc(1,ee,3,2,"ng-container",16),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.PRODUCT_SELECTED.units)}}function ne(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"select",95),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.unidad_product=n)})("change",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.changeUnitProduct(n))}),e.TgZ(1,"option",15),e._uU(2,"Selec. Unidad"),e.qZA(),e.YNc(3,te,2,1,"ng-container",21),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.unidad_product),e.xp6(3),e.Q6J("ngIf",t.PRODUCT_SELECTED)}}function oe(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",91),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.AsE("",t.warehouse.name," (",t.quantity,")")}}function ie(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",51)(1,"label",11),e._uU(2,"\xbfEs gratuito?"),e.qZA(),e.TgZ(3,"div",96)(4,"input",97),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.isGift())}),e.qZA(),e.TgZ(5,"label",98),e._uU(6,"Costo 0"),e.qZA()()()}}function re(i,s){1&i&&(e.TgZ(0,"span",99),e._uU(1,"No hay de esa unidad disponible en ninguna sucursal"),e.qZA())}function ae(i,s){1&i&&(e.TgZ(0,"span",99),e._uU(1,"No hay de esa unidad disponible en nuestra sucursal"),e.qZA())}function se(i,s){if(1&i&&(e.TgZ(0,"span",100),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.message_disponibilidad)}}function de(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",101)(1,"input",102,103),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.amount_discount=n)}),e.qZA(),e.TgZ(3,"small"),e._uU(4,"Descuento del producto"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.amount_discount)}}function ce(i,s){if(1&i&&(e.TgZ(0,"span",83),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij(" ",((t.price-t.amount_discount+(t.price-t.amount_discount)*t.PRODUCT_SELECTED.importe_iva*.01)*t.quantity_product).toFixed(2)," ")}}function le(i,s){1&i&&(e.TgZ(0,"span",83),e._uU(1," 0 "),e.qZA())}function _e(i,s){if(1&i&&(e.ynx(0),e._UZ(1,"br"),e._uU(2),e.BQk()),2&i){const t=e.oxw();e.xp6(2),e.hij(" Impuesto: ",(t.price-t.amount_discount)*t.PRODUCT_SELECTED.importe_iva*.01," PEN ")}}function ue(i,s){1&i&&(e.ynx(0),e._UZ(1,"br"),e._uU(2," Impuesto: 0 PEN "),e.BQk())}function pe(i,s){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"tr")(2,"td")(3,"a",104),e._uU(4),e.qZA()(),e.TgZ(5,"td")(6,"span",105),e._uU(7),e.qZA()(),e.TgZ(8,"td")(9,"a",106),e._uU(10),e.qZA()(),e.TgZ(11,"td")(12,"a",107),e._uU(13),e.qZA()(),e.TgZ(14,"td",108)(15,"a",106),e._uU(16),e.qZA()(),e.TgZ(17,"td")(18,"a",106),e._uU(19),e.qZA()(),e.TgZ(20,"td",109)(21,"a",110),e.NdJ("click",function(){const n=e.CHM(t),r=n.$implicit,a=n.index,_=e.oxw();return e.KtG(_.editProduct(r,a))}),e.TgZ(22,"i",111),e._UZ(23,"span",30)(24,"span",31),e.qZA()(),e.TgZ(25,"a",112),e.NdJ("click",function(){const n=e.CHM(t),r=n.$implicit,a=n.index,_=e.oxw();return e.KtG(_.deleteProduct(r,a))}),e.TgZ(26,"i",113),e._UZ(27,"span",30)(28,"span",31)(29,"span",40)(30,"span",41)(31,"span",42),e.qZA()()()(),e.BQk()}if(2&i){const t=s.$implicit;e.xp6(4),e.hij(" ",t.product.title," "),e.xp6(3),e.hij("Unidad: ",t.unit.name,""),e.xp6(3),e.hij("",t.price_unit," PEN"),e.xp6(3),e.Oqu(t.quantity),e.xp6(3),e.hij("",t.subtotal," PEN"),e.xp6(3),e.hij("",t.total," PEN")}}function me(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",91),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function ge(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"textarea",114),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.address=n)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.address)}}function he(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",91),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function fe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",51)(1,"select",115),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.ubigeo_region=n)})("change",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.changeRegion(n))}),e.TgZ(2,"option",15),e._uU(3,"Selec. Regi\xf3n"),e.qZA(),e.YNc(4,he,3,2,"ng-container",16),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.ubigeo_region),e.xp6(3),e.Q6J("ngForOf",t.REGIONES)}}function Te(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",91),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function Ee(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",51)(1,"select",116),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.ubigeo_provincia=n)})("change",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.changeProvincia(n))}),e.TgZ(2,"option",15),e._uU(3,"Selec. Provincia"),e.qZA(),e.YNc(4,Te,3,2,"ng-container",16),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.ubigeo_provincia),e.xp6(3),e.Q6J("ngForOf",t.PROVINCIA_SELECTEDS)}}function Ce(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",91),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function Pe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",51)(1,"select",117),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.ubigeo_distrito=n)}),e.TgZ(2,"option",15),e._uU(3,"Selec. Distrito"),e.qZA(),e.YNc(4,Ce,3,2,"ng-container",16),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.ubigeo_distrito),e.xp6(3),e.Q6J("ngForOf",t.DISTRITO_SELECTEDS)}}function ve(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",51)(1,"input",118),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.agencia=n)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.agencia)}}function Ze(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",51)(1,"input",119),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.full_name_encargado=n)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.full_name_encargado)}}function be(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",51)(1,"input",120),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.documento_encargado=n)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.documento_encargado)}}function Ae(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",51)(1,"input",121),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.telefono_encargado=n)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.telefono_encargado)}}let De=(()=>{class i{modalService;proformaService;toast;CLIENT_SELECTED;n_document="";full_name="";phone="";search_product="";price=0;description_product="";quantity_product=0;unidad_product="";almacen_product="";PRODUCT_SELECTED;loadUnidad=!1;warehouses_product=[];exits_warehouse=[];amount_discount=0;DETAIL_PROFORMAS=[];description="";agencia="";full_name_encargado="";documento_encargado="";telefono_encargado="";REGIONES=N.c;PROVINCIAS=I.M;DISTRITOS=R.x;PROVINCIA_SELECTEDS=[];DISTRITO_SELECTEDS=[];ubigeo_region="";ubigeo_provincia="";ubigeo_distrito="";region="";provincia="";distrito="";sucursale_deliverie_id="";address="";date_entrega=null;isLoading$;client_segments=[];asesores=[];sucursale_deliveries=[];method_payments=[];user;sucursale_asesor="";method_payment_id="";METHOD_PAYMENT_SELECTED;banco_id="";amount_payment=0;payment_file;imagen_previzualiza="";message_disponibilidad=null;TOTAL_PROFORMA=0;TOTAL_IMPUESTO_PROFORMA=0;DEBT_PROFORMA=0;PAID_OUT_PROFORMA=0;is_gift=1;TODAY="Y/m/d";eval_disponibilidad=!0;source;something;constructor(t,o,n){this.modalService=t,this.proformaService=o,this.toast=n}ngOnInit(){this.isLoading$=this.proformaService.isLoading$,this.user=this.proformaService.authservice.user,this.sucursale_asesor=this.user.sucursale_id,this.proformaService.configAll().subscribe(t=>{console.log(t),this.client_segments=t.client_segments,this.asesores=t.asesores,this.sucursale_deliveries=t.sucursale_deliveries,this.method_payments=t.method_payments,this.TODAY=t.today})}initKeyUpDiscount(){this.source=(0,T.R)(this.something.nativeElement,"keyup"),this.source.pipe((0,C.b)(1200)).subscribe(t=>{console.log(t),this.verifiedDiscount(),this.isLoadingProcess()})}isLoadingProcess(){this.proformaService.isLoadingSubject.next(!0),setTimeout(()=>{this.proformaService.isLoadingSubject.next(!1)},50)}searchClients(){this.n_document||this.full_name||this.phone?this.proformaService.searchClients(this.n_document,this.full_name,this.phone).subscribe(t=>{console.log(t),t.clients.length>1?this.openSelectedClients(t.clients):1==t.clients.length?(this.CLIENT_SELECTED=t.clients[0],this.n_document=this.CLIENT_SELECTED.n_document,this.full_name=this.CLIENT_SELECTED.full_name,this.phone=this.CLIENT_SELECTED.phone,this.toast.success("Exito","Se selecciono al cliente de la proforma"),this.isLoadingProcess()):this.toast.error("Validaci\xf3n","No hay coincidencia en la busqueda")}):this.toast.error("Validaci\xf3n","Necesitas ingresar al menos uno de los campos")}openSelectedClients(t=[]){const o=this.modalService.open(x.M,{size:"lg",centered:!0});o.componentInstance.clients=t,o.componentInstance.ClientSelected.subscribe(n=>{this.CLIENT_SELECTED=n,this.n_document=this.CLIENT_SELECTED.n_document,this.full_name=this.CLIENT_SELECTED.full_name,this.phone=this.CLIENT_SELECTED.phone,this.isLoadingProcess(),this.toast.success("Exito","Se selecciono al cliente de la proforma")})}createClientPerson(){const t=this.modalService.open(O.q,{size:"lg",centered:!0});t.componentInstance.client_segments=this.client_segments,t.componentInstance.asesores=this.asesores,t.componentInstance.ClientsC.subscribe(o=>{this.CLIENT_SELECTED=o,this.n_document=this.CLIENT_SELECTED.n_document,this.full_name=this.CLIENT_SELECTED.full_name,this.phone=this.CLIENT_SELECTED.phone,this.isLoadingProcess()})}createClientCompany(){const t=this.modalService.open(A.P,{size:"lg",centered:!0});t.componentInstance.client_segments=this.client_segments,t.componentInstance.asesores=this.asesores,t.componentInstance.ClientsC.subscribe(o=>{this.CLIENT_SELECTED=o,this.n_document=this.CLIENT_SELECTED.n_document,this.full_name=this.CLIENT_SELECTED.full_name,this.phone=this.CLIENT_SELECTED.phone,this.isLoadingProcess()})}resetClient(){this.CLIENT_SELECTED=null,this.n_document="",this.full_name="",this.phone="",this.isLoadingProcess()}searchProducts(){this.search_product?this.proformaService.searchProducts(this.search_product).subscribe(t=>{console.log(t),t.products.data.length>1?this.openSelectedProduct(t.products.data):1==t.products.data.length?(this.PRODUCT_SELECTED=t.products.data[0],this.search_product=this.PRODUCT_SELECTED.title,setTimeout(()=>{this.initKeyUpDiscount()},50),this.toast.success("Exito","Se selecciono al producto para la proforma"),this.isLoadingProcess()):this.toast.error("Validaci\xf3n","No hay coincidencia en la busqueda")}):this.toast.error("Validaci\xf3n","Necesitas ingresar al menos uno de los campos")}openSelectedProduct(t=[]){const o=this.modalService.open(E.T,{size:"lg",centered:!0});o.componentInstance.products=t,o.componentInstance.ProductSelected.subscribe(n=>{this.PRODUCT_SELECTED=n,this.search_product=this.PRODUCT_SELECTED.title,setTimeout(()=>{this.initKeyUpDiscount()},50),this.isLoadingProcess(),this.toast.success("Exito","Se selecciono el producto para la proforma")})}changeUnitProduct(t){if(console.log(t.target.value),!this.CLIENT_SELECTED)return this.loadUnidad=!0,this.unidad_product="",setTimeout(()=>{this.loadUnidad=!1},50),this.toast.error("Validaci\xf3n","Es necesario seleccionar a un cliente"),void this.isLoadingProcess();let o=t.target.value;this.warehouses_product=this.PRODUCT_SELECTED.warehouses.filter(d=>d.unit.id==o),this.exits_warehouse=this.warehouses_product.filter(d=>d.warehouse.sucursale_id==this.sucursale_asesor);let n=this.PRODUCT_SELECTED.wallets,r=n.filter(d=>d.unit&&d.sucursale&&d.client_segment),a=r.find(d=>d.unit.id==o&&d.sucursale.id==this.sucursale_asesor&&d.client_segment.id==this.CLIENT_SELECTED.client_segment.id);if(a)return this.price=a.price_general,void(2==this.is_gift&&(this.price=0));r=n.filter(d=>d.unit&&d.sucursale&&!d.client_segment);let _=r.find(d=>d.unit.id==o&&d.sucursale.id==this.sucursale_asesor&&null==d.client_segment);r=n.filter(d=>d.unit&&!d.sucursale&&d.client_segment);let p=r.find(d=>d.unit.id==o&&null==d.sucursale&&d.client_segment.id==this.CLIENT_SELECTED.client_segment.id);if(_&&p)return this.price=_.price_general<p.price_general?_.price_general:p.price_general,void(2==this.is_gift&&(this.price=0));if(_)return this.price=_.price_general,void(2==this.is_gift&&(this.price=0));if(p)return this.price=p.price_general,void(2==this.is_gift&&(this.price=0));let Z=n.find(d=>d.unit.id==o&&null==d.sucursale&&null==d.client_segment);if(Z)return this.price=Z.price_general,void(2==this.is_gift&&(this.price=0));this.price=this.PRODUCT_SELECTED.price_general,2==this.is_gift&&(this.price=0)}verifiedDiscount(){return console.log(this.amount_discount),this.amount_discount>.01*this.PRODUCT_SELECTED.max_discount*this.price?(this.toast.error("VALIDACI\xd3N","EL DESCUENTO SUPERA EL MONTO QUE TIENE CONFIGURADO"),void(this.amount_discount=0)):this.amount_discount<.01*this.PRODUCT_SELECTED.min_discount*this.price?(this.toast.error("VALIDACI\xd3N","EL DESCUENTO NO SUPERA EL MONTO QUE TIENE CONFIGURADO"),void(this.amount_discount=0)):void 0}isGift(){this.is_gift=1==this.is_gift?2:1,2==this.is_gift&&(this.price=0)}addProduct(){if(!this.PRODUCT_SELECTED)return void this.toast.error("Validaci\xf3n","No hay seleccionado un producto");if(1==this.is_gift&&0==this.price)return void this.toast.error("Validaci\xf3n","No hay precio del producto");if(0==this.quantity_product)return void this.toast.error("Validaci\xf3n","No hay cantidad solicitada del producto");if(!this.unidad_product)return void this.toast.error("Validaci\xf3n","No hay unidad del producto");if(this.PRODUCT_SELECTED&&2==this.PRODUCT_SELECTED.disponiblidad&&(this.unidad_product&&0==this.warehouses_product.length||this.unidad_product&&this.warehouses_product.length>0&&0==this.exits_warehouse.length))return void this.toast.error("Validaci\xf3n","El producto no se puede agregar debido a que no hay exitencias disponibles");if(3==this.PRODUCT_SELECTED.disponiblidad&&this.eval_disponibilidad)return void this.proformaService.evalDisponibilidad(this.PRODUCT_SELECTED.id,this.unidad_product,this.quantity_product).subscribe(r=>{console.log(r),this.message_disponibilidad=r.message,this.eval_disponibilidad=!1});let t=this.price-this.amount_discount,o=t*(.01*this.PRODUCT_SELECTED.importe_iva),n=this.PRODUCT_SELECTED.units.find(r=>r.id==this.unidad_product);this.DETAIL_PROFORMAS.push({product:this.PRODUCT_SELECTED,description:this.description_product,unidad_product:this.unidad_product,unit:n,quantity:this.quantity_product,discount:this.amount_discount,price_unit:this.price,subtotal:t,impuesto:o,total:(t+o)*this.quantity_product}),this.resetProduct(),this.sumTotalDetail()}resetProduct(){this.PRODUCT_SELECTED=null,this.search_product="",this.price=0,this.quantity_product=0,this.warehouses_product=[],this.amount_discount=0,this.description_product="",this.unidad_product="",this.almacen_product="",this.is_gift=1,this.message_disponibilidad="",this.eval_disponibilidad=!0}sumTotalDetail(){this.TOTAL_PROFORMA=this.DETAIL_PROFORMAS.reduce((t,o)=>t+o.total,0),this.TOTAL_IMPUESTO_PROFORMA=this.DETAIL_PROFORMAS.reduce((t,o)=>t+o.impuesto,0),this.DEBT_PROFORMA=this.TOTAL_PROFORMA,this.isLoadingProcess()}editProduct(t,o){const n=this.modalService.open(S,{size:"md",centered:!0});n.componentInstance.DETAIL_PRODUCT=t,n.componentInstance.sucursale_asesor=this.sucursale_asesor,n.componentInstance.CLIENT_SELECTED=this.CLIENT_SELECTED,n.componentInstance.EditProductProforma.subscribe(r=>{this.DETAIL_PROFORMAS[o]=r,this.isLoadingProcess(),this.sumTotalDetail()})}deleteProduct(t,o){const n=this.modalService.open(U,{size:"md",centered:!0});n.componentInstance.DETAIL_PRODUCT=t,n.componentInstance.DeleteProductProforma.subscribe(r=>{this.DETAIL_PROFORMAS.splice(o,1),this.isLoadingProcess(),this.sumTotalDetail()})}validationDeliverie(){if(this.sucursale_deliverie_id){let t=this.sucursale_deliveries.find(o=>o.id==this.sucursale_deliverie_id);if(t&&-1!=t.name.indexOf(this.user.sucursale_name))return!1}return!0}changeRegion(t){console.log(t.target.value);let o=t.target.value,n=this.REGIONES.find(a=>a.id==o);n&&(this.region=n.name);let r=this.PROVINCIAS.filter(a=>a.department_id==o);console.log(r),this.PROVINCIA_SELECTEDS=r}changeProvincia(t){console.log(t.target.value);let o=t.target.value,n=this.PROVINCIAS.find(a=>a.id==o);n&&(this.provincia=n.name);let r=this.DISTRITOS.filter(a=>a.province_id==o);console.log(r),this.DISTRITO_SELECTEDS=r}resetSucursaleDeliverie(){this.agencia="",this.full_name_encargado="",this.documento_encargado="",this.telefono_encargado="",this.region="",this.distrito="",this.provincia="",this.ubigeo_region="",this.ubigeo_provincia="",this.ubigeo_distrito="",this.sucursale_deliverie_id="",this.address="",this.date_entrega=null}changeMethodPayment(){this.METHOD_PAYMENT_SELECTED=this.method_payments.find(t=>t.id==this.method_payment_id),this.banco_id=""}processFile(t){if(t.target.files[0].type.indexOf("image")<0)return void this.toast.warning("WARN","El archivo no es una imagen");this.payment_file=t.target.files[0];let o=new FileReader;o.readAsDataURL(this.payment_file),o.onloadend=()=>this.imagen_previzualiza=o.result,this.isLoadingProcess()}save(){if(!this.CLIENT_SELECTED)return void this.toast.error("Validaci\xf3n","Necesitas seleccionar un cliente");if(0==this.DETAIL_PROFORMAS.length)return void this.toast.error("Validaci\xf3n","Necesitas agregar productos a la proforma");if(!this.sucursale_deliverie_id)return void this.toast.error("Validaci\xf3n","El lugar de entrega es requerido");if(!this.date_entrega)return void this.toast.error("Validaci\xf3n","La fecha de entrega es requerido");if(this.validationDeliverie()&&5!=this.sucursale_deliverie_id){if(!this.agencia)return void this.toast.error("Validaci\xf3n","La agencia es requerido");if(!this.full_name_encargado)return void this.toast.error("Validaci\xf3n","El nombre del encargado es requerido");if(!this.documento_encargado)return void this.toast.error("Validaci\xf3n","El documento del encargado es requerido");if(!this.telefono_encargado)return void this.toast.error("Validaci\xf3n","El telefono del encargado es requerido")}if(6==this.sucursale_deliverie_id){if(!this.ubigeo_region)return void this.toast.error("Validaci\xf3n","La region es requerido");if(!this.ubigeo_provincia)return void this.toast.error("Validaci\xf3n","La provincia es requerido");if(!this.ubigeo_distrito)return void this.toast.error("Validaci\xf3n","La distrito es requerido")}if(1!=this.CLIENT_SELECTED.client_segment.id&&1==this.CLIENT_SELECTED.is_parcial){if(!this.method_payment_id)return void this.toast.error("Validaci\xf3n","El metodo de pago es requerido");if(this.METHOD_PAYMENT_SELECTED.bancos.length>0&&!this.banco_id)return void this.toast.error("Validaci\xf3n","El banco es requerido");if(!this.amount_payment)return void this.toast.error("Validaci\xf3n","El monto de pago es requerido");if(0==this.amount_payment)return void this.toast.error("Validaci\xf3n","El monto de pago es requerido");if(!this.payment_file)return void this.toast.error("Validaci\xf3n","El vaucher de pago es requerido")}let t=this.DISTRITOS.find(n=>n.id==this.ubigeo_distrito);t&&(this.distrito=t.name);let o=new FormData;o.append("client_id",this.CLIENT_SELECTED.id),o.append("client_segment_id",this.CLIENT_SELECTED.client_segment.id),o.append("subtotal",this.TOTAL_PROFORMA+""),o.append("total",this.TOTAL_PROFORMA+""),o.append("igv",this.TOTAL_IMPUESTO_PROFORMA+""),o.append("debt",this.DEBT_PROFORMA-(this.amount_payment?this.amount_payment:0)+""),o.append("paid_out",this.PAID_OUT_PROFORMA+(this.amount_payment?this.amount_payment:0)+""),o.append("description",this.description),o.append("DETAIL_PROFORMAS",JSON.stringify(this.DETAIL_PROFORMAS)),o.append("sucursale_deliverie_id",this.sucursale_deliverie_id),o.append("date_entrega",this.date_entrega),this.address&&o.append("address",this.address),this.validationDeliverie()&&(o.append("agencia",this.agencia),o.append("full_name_encargado",this.full_name_encargado),o.append("documento_encargado",this.documento_encargado),o.append("telefono_encargado",this.telefono_encargado)),6==this.sucursale_deliverie_id&&(o.append("ubigeo_region",this.ubigeo_region),o.append("ubigeo_provincia",this.ubigeo_provincia),o.append("ubigeo_distrito",this.ubigeo_distrito),o.append("region",this.region),o.append("provincia",this.provincia),o.append("distrito",this.distrito)),(this.method_payment_id||this.amount_payment)&&(o.append("method_payment_id",this.method_payment_id),this.banco_id&&o.append("banco_id",this.banco_id),o.append("amount_payment",this.amount_payment+""),o.append("payment_file",this.payment_file)),this.proformaService.createProforma(o).subscribe(n=>{console.log(n),this.toast.success("Exito","LA proforma se creo con exito"),this.resetClient(),this.DETAIL_PROFORMAS=[],this.resetSucursaleDeliverie(),this.TOTAL_PROFORMA=0,this.method_payment_id="",this.amount_payment=0,this.imagen_previzualiza="",this.payment_file=null,this.TOTAL_IMPUESTO_PROFORMA=0,this.DEBT_PROFORMA=0,this.PAID_OUT_PROFORMA=0,this.banco_id="",this.description="",this.isLoadingProcess()},n=>{console.log(n),this.toast.error("Validaci\xf3n","Hubo un error en el servidor, intente nuevamente o acceda a la consola y vea que sucede")})}static \u0275fac=function(o){return new(o||i)(e.Y36(m.FF),e.Y36(D),e.Y36(P._W))};static \u0275cmp=e.Xpm({type:i,selectors:[["app-create-proforma"]],viewQuery:function(o,n){if(1&o&&e.Gf(z,5),2&o){let r;e.iGM(r=e.CRH())&&(n.something=r.first)}},decls:234,vars:48,consts:[["data-select2-id","select2-data-131-dzps",1,"d-flex","flex-column","flex-column-fluid"],["id","kt_app_content","data-select2-id","select2-data-kt_app_content",1,"app-content","flex-column-fluid"],["id","kt_app_content_container","data-select2-id","select2-data-kt_app_content_container",1,"app-container","container-xxl"],["id","kt_ecommerce_edit_order_form","data-kt-redirect","/metronic8/demo1/apps/ecommerce/sales/listing.html","data-select2-id","select2-data-kt_ecommerce_edit_order_form",1,"form","d-flex","flex-column","flex-lg-row","fv-plugins-bootstrap5","fv-plugins-framework"],["data-select2-id","select2-data-130-y9wa",1,"w-100","flex-lg-row-auto","w-lg-300px","mb-7","me-7","me-lg-10"],["data-select2-id","select2-data-129-w2zd",1,"card","card-flush","py-4"],[1,"card-header"],[1,"card-title"],["data-select2-id","select2-data-128-9mmu",1,"card-body","pt-0"],["data-select2-id","select2-data-127-2qsf",1,"d-flex","flex-column","gap-10"],[1,"fv-row"],[1,"form-label"],[1,"fw-bold","fs-3"],[1,"fv-row","mt-4"],["name","method_payment_id","placeholder","Selec. Metodo de pago",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange","change"],["value",""],[4,"ngFor","ngForOf"],["class","fv-row",4,"ngIf"],["type","number","name","amount_payment","placeholder","Monto",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["for","formFile",1,"form-label"],["type","file","accept",".jpeg, .bmp, .jpg, .png, .gif, .webp","id","formFile",1,"form-control",3,"change"],[4,"ngIf"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"d-flex","flex-column","flex-lg-row-fluid","gap-7","gap-lg-10"],[1,"card","card-flush","py-4"],[1,"card-header",2,"display","block"],[1,"row","justify-content-between"],[1,"col-6","d-flex","align-items-center"],[1,"d-flex","align-items-center"],[1,"ki-duotone","ki-user","fs-2tx"],[1,"path1"],[1,"path2"],[1,"mx-2"],[1,"col-4"],["placement","top-start","ngbTooltip","Buscar",1,"btn","btn-sm","mx-1","btn-primary",3,"click"],[1,"ki-duotone","ki-magnifier","fs-2"],["placement","top-start","ngbTooltip","Cliente Persona",1,"btn","btn-sm","mx-1","btn-success",3,"click"],[1,"ki-duotone","ki-user","fs-2"],["placement","top-start","ngbTooltip","Cliente Empresa",1,"btn","btn-sm","mx-1","btn-info",3,"click"],[1,"ki-duotone","ki-delivery-time","fs-2"],[1,"path3"],[1,"path4"],[1,"path5"],["placement","top-start","ngbTooltip","Limpiar",1,"btn","btn-sm","mx-1","btn-dark",3,"click"],[1,"ki-duotone","ki-arrows-circle","fs-2"],[1,"card-body","pt-0"],[1,"row"],["type","text","name","n_document","placeholder"," N\xb0 Documento",1,"form-control","mb-2",3,"ngModel","keyup.enter","ngModelChange"],["type","text","name","full_name","placeholder","Nombre completo",1,"form-control","mb-2",3,"ngModel","keyup.enter","ngModelChange"],["type","text","name","phone","placeholder","Telefono",1,"form-control","mb-2",3,"ngModel","keyup.enter","ngModelChange"],[1,"ki-duotone","ki-delivery-door","fs-2tx"],[1,"col-3"],["placement","top-start","ngbTooltip","Agregar",1,"btn","btn-sm","mx-1","btn-info",3,"click"],[1,"ki-duotone","ki-add-folder","fs-2"],[1,"d-flex","flex-column","gap-10"],["id","kt_ecommerce_edit_order_product_table_wrapper",1,"dt-container","dt-bootstrap5","dt-empty-footer"],["id","",1,"row"],[1,"col-6"],[1,"d-flex","align-items-center","position-relative","mb-n7"],[1,"ki-duotone","ki-magnifier","fs-3","position-absolute","ms-4"],["type","text","data-kt-ecommerce-edit-order-filter","search","placeholder","Buscar Producto","name","search_product",1,"form-control","form-control-solid","w-100","ps-12",3,"ngModel","ngModelChange","keyup.enter"],["type","number","disabled","","name","price","placeholder","Precio",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["type","number","name","quantity_product","placeholder","Cantidad",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["class","form-control form-select-solid fw-bolder","name","unidad_product","placeholder","Selec. Unidad",3,"ngModel","ngModelChange","change",4,"ngIf"],["name","almacen_product","placeholder","Selec. Almacen",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange"],["rows","3","name","description_product","placeholder","Nota",1,"form-control","form-control-solid",3,"ngModel","ngModelChange"],["class","col-3",4,"ngIf"],["class","text-danger",4,"ngIf"],["class","text-info",4,"ngIf"],["class","col-4 mt-1",4,"ngIf"],[1,"separator"],[1,"fw-bold","fs-4"],["id","kt_ecommerce_edit_order_total_price",4,"ngIf"],[1,"col-5"],[1,"ki-duotone","ki-questionnaire-tablet","text-gray-900","fs-2tx"],[1,"col-12"],[1,"table-responsive"],[1,"table","table-row-bordered","table-row-gray-100","align-middle","gs-0","gy-3"],[1,"fw-bold","text-muted"],[1,"min-w-150px"],[1,"min-w-140px"],[1,"min-w-120px"],[1,"min-w-100px","text-end"],["id","kt_ecommerce_edit_order_total_price"],[1,"ki-duotone","ki-delivery-geolocation","text-gray-900","fs-2tx"],["name","sucursale_deliverie_id","placeholder","Selec. Lugar de entrega",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange"],["class","form-control form-control-solid","rows","3","name","address","placeholder","Direcci\xf3n completa",3,"ngModel","ngModelChange",4,"ngIf"],["type","date","name","date_entrega",1,"form-control","form-control-lg","form-control-solid",3,"ngModel","ngModelChange"],["rows","3","name","description","placeholder","Descripci\xf3n general",1,"form-control","form-control-solid","mx-2",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary",3,"click"],[1,"indicator-label"],[3,"value"],["name","banco_id","placeholder","Selec. Banco",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange"],["width","125px","alt","",3,"src"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"],["name","unidad_product","placeholder","Selec. Unidad",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange","change"],[1,"form-check","form-check-custom","form-check-solid","mb-2"],["type","checkbox",1,"form-check-input",3,"click"],[1,"form-check-label"],[1,"text-danger"],[1,"text-info"],[1,"col-4","mt-1"],["type","number","name","amount_discount","placeholder","Descuento",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["discount",""],["href","#","onclick","return false;",1,"text-gray-900","fw-bold","text-hover-primary","fs-6"],[1,"text-muted","fw-semibold","text-muted","d-block","fs-7"],["href","#","onclick","return false;",1,"text-gray-900","fw-bold","text-hover-primary","d-block","mb-1","fs-6",2,"text-wrap","nowrap"],["href","#","onclick","return false;",1,"text-gray-900","fw-bold","text-hover-primary","d-block","mb-1","fs-6"],[1,"text-gray-900","fw-bold","text-hover-primary","fs-6"],[1,"text-end"],["href","#","onclick","return false;",1,"btn","btn-icon","btn-bg-light","btn-active-color-primary","btn-sm","me-1",3,"click"],[1,"ki-duotone","ki-pencil","fs-2"],["href","#","onclick","return false",1,"btn","btn-icon","btn-bg-light","btn-active-color-primary","btn-sm",3,"click"],[1,"ki-duotone","ki-trash","fs-2"],["rows","3","name","address","placeholder","Direcci\xf3n completa",1,"form-control","form-control-solid",3,"ngModel","ngModelChange"],["name","ubigeo_region","placeholder","Selec. Regi\xf3n",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange","change"],["name","ubigeo_provincia","placeholder","Selec. Provincia",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange","change"],["name","ubigeo_distrito","placeholder","Selec. Distrito",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange"],["type","text","name","agencia","placeholder"," Agencia de Envio",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["type","text","name","full_name_encargado","placeholder","Nombre del encargado de recojo",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["type","text","name","documento_encargado","placeholder","Documento del encargado de recojo",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["type","text","name","telefono_encargado","placeholder","Telefono del encargado de recojo",1,"form-control","mb-2",3,"ngModel","ngModelChange"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"h2"),e._uU(9,"Proforma"),e.qZA()()(),e.TgZ(10,"div",8)(11,"div",9)(12,"div",10)(13,"label",11),e._uU(14,"Fecha"),e.qZA(),e.TgZ(15,"div",12),e._uU(16),e.qZA()(),e.TgZ(17,"div",13)(18,"select",14),e.NdJ("ngModelChange",function(a){return n.method_payment_id=a})("change",function(){return n.changeMethodPayment()}),e.TgZ(19,"option",15),e._uU(20,"Selec. Metodo de pago"),e.qZA(),e.YNc(21,K,3,2,"ng-container",16),e.qZA()(),e.YNc(22,$,5,2,"div",17),e.TgZ(23,"div",10)(24,"input",18),e.NdJ("ngModelChange",function(a){return n.amount_payment=a}),e.qZA()(),e.TgZ(25,"div",10)(26,"label",19),e._uU(27,"Comprobante"),e.qZA(),e.TgZ(28,"input",20),e.NdJ("change",function(a){return n.processFile(a)}),e.qZA(),e.YNc(29,W,2,1,"div",21),e.qZA()()()()(),e.YNc(30,X,1,0,"span",22),e.ALo(31,"async"),e.TgZ(32,"div",23)(33,"div",24)(34,"div",25)(35,"div",26)(36,"div",27)(37,"h2",28)(38,"i",29),e._UZ(39,"span",30)(40,"span",31),e.qZA(),e._uU(41," Cliente : "),e.qZA(),e.TgZ(42,"small",32),e._uU(43),e.qZA()(),e.TgZ(44,"div",33)(45,"button",34),e.NdJ("click",function(){return n.searchClients()}),e.TgZ(46,"i",35),e._UZ(47,"span",30)(48,"span",31),e.qZA()(),e.TgZ(49,"button",36),e.NdJ("click",function(){return n.createClientPerson()}),e.TgZ(50,"i",37),e._UZ(51,"span",30)(52,"span",31),e.qZA()(),e.TgZ(53,"button",38),e.NdJ("click",function(){return n.createClientCompany()}),e.TgZ(54,"i",39),e._UZ(55,"span",30)(56,"span",31)(57,"span",40)(58,"span",41)(59,"span",42),e.qZA()(),e.TgZ(60,"button",43),e.NdJ("click",function(){return n.resetClient()}),e.TgZ(61,"i",44),e._UZ(62,"span",30)(63,"span",31),e.qZA()()()()(),e.TgZ(64,"div",45)(65,"div",46)(66,"div",33)(67,"input",47),e.NdJ("keyup.enter",function(){return n.searchClients()})("ngModelChange",function(a){return n.n_document=a}),e.qZA()(),e.TgZ(68,"div",33)(69,"input",48),e.NdJ("keyup.enter",function(){return n.searchClients()})("ngModelChange",function(a){return n.full_name=a}),e.qZA()(),e.TgZ(70,"div",33)(71,"input",49),e.NdJ("keyup.enter",function(){return n.searchClients()})("ngModelChange",function(a){return n.phone=a}),e.qZA()()()()(),e.TgZ(72,"div",24)(73,"div",25)(74,"div",26)(75,"div",27)(76,"h2",28)(77,"i",50),e._UZ(78,"span",30)(79,"span",31)(80,"span",40)(81,"span",41),e.qZA(),e._uU(82," Producto :"),e.qZA(),e.TgZ(83,"small",32),e._uU(84),e.qZA()(),e.TgZ(85,"div",51)(86,"button",34),e.NdJ("click",function(){return n.searchProducts()}),e.TgZ(87,"i",35),e._UZ(88,"span",30)(89,"span",31),e.qZA()(),e.TgZ(90,"button",43),e.NdJ("click",function(){return n.resetProduct()}),e.TgZ(91,"i",44),e._UZ(92,"span",30)(93,"span",31),e.qZA()(),e.TgZ(94,"button",52),e.NdJ("click",function(){return n.addProduct()}),e.TgZ(95,"i",53),e._UZ(96,"span",30)(97,"span",31),e.qZA()()()()(),e.TgZ(98,"div",45)(99,"div",54)(100,"div",55)(101,"div",56)(102,"div",57)(103,"div",58)(104,"i",59),e._UZ(105,"span",30)(106,"span",31),e.qZA(),e.TgZ(107,"input",60),e.NdJ("ngModelChange",function(a){return n.search_product=a})("keyup.enter",function(){return n.searchProducts()}),e.qZA()()(),e.TgZ(108,"div",51)(109,"input",61),e.NdJ("ngModelChange",function(a){return n.price=a}),e.qZA(),e.TgZ(110,"small"),e._uU(111,"Precio del producto"),e.qZA()(),e.TgZ(112,"div",51)(113,"input",62),e.NdJ("ngModelChange",function(a){return n.quantity_product=a}),e.qZA(),e.TgZ(114,"small"),e._uU(115,"Cantidad del producto"),e.qZA()(),e.TgZ(116,"div",51),e.YNc(117,ne,4,2,"select",63),e.qZA(),e.TgZ(118,"div",51)(119,"select",64),e.NdJ("ngModelChange",function(a){return n.almacen_product=a}),e.TgZ(120,"option",15),e._uU(121,"Selec. Almacen"),e.qZA(),e.YNc(122,oe,3,3,"ng-container",16),e.qZA()(),e.TgZ(123,"div",51)(124,"textarea",65),e.NdJ("ngModelChange",function(a){return n.description_product=a}),e.qZA()(),e.YNc(125,ie,7,0,"div",66),e.TgZ(126,"div",57),e.YNc(127,re,2,0,"span",67),e._UZ(128,"br"),e.YNc(129,ae,2,0,"span",67),e.YNc(130,se,2,1,"span",68),e._UZ(131,"br"),e.qZA(),e.YNc(132,de,5,1,"div",69),e.qZA()(),e._UZ(133,"div",70),e.TgZ(134,"div")(135,"div",71),e._uU(136," Costo Total: "),e.YNc(137,ce,2,1,"span",72),e.YNc(138,le,2,0,"span",72),e._uU(139," PEN "),e._UZ(140,"br"),e._uU(141),e.YNc(142,_e,3,1,"ng-container",21),e.YNc(143,ue,3,0,"ng-container",21),e.qZA()()()()(),e.TgZ(144,"div",24)(145,"div",25)(146,"div",26)(147,"div",73)(148,"h2",28)(149,"i",74),e._UZ(150,"span",30)(151,"span",31),e.qZA(),e._uU(152," Detallado de la proforma : "),e.qZA()(),e._UZ(153,"div",51),e.qZA()(),e.TgZ(154,"div",45)(155,"div",46)(156,"div",75)(157,"div",76)(158,"table",77)(159,"thead")(160,"tr",78)(161,"th",79),e._uU(162,"Producto"),e.qZA(),e.TgZ(163,"th",80),e._uU(164,"Unidad"),e.qZA(),e.TgZ(165,"th",81),e._uU(166,"Precio Unitario"),e.qZA(),e.TgZ(167,"th",81),e._uU(168,"Cantidad"),e.qZA(),e.TgZ(169,"th",81),e._uU(170,"SubTotal"),e.qZA(),e.TgZ(171,"th",81),e._uU(172,"Total"),e.qZA(),e.TgZ(173,"th",82),e._uU(174,"Actions"),e.qZA()()(),e.TgZ(175,"tbody"),e.YNc(176,pe,32,6,"ng-container",16),e.qZA()()()()(),e._UZ(177,"div",70),e.TgZ(178,"div")(179,"div",71),e._uU(180," Total: "),e.TgZ(181,"span",83),e._uU(182),e.qZA(),e._uU(183," PEN "),e._UZ(184,"br"),e._uU(185),e._UZ(186,"br"),e._uU(187),e._UZ(188,"br"),e._uU(189),e.qZA()()()(),e.TgZ(190,"div",24)(191,"div",25)(192,"div",26)(193,"div",33)(194,"h2",28)(195,"i",84),e._UZ(196,"span",30)(197,"span",31)(198,"span",40)(199,"span",41)(200,"span",42),e.qZA(),e._uU(201," Lugar de entrega : "),e.qZA()(),e.TgZ(202,"div",51)(203,"button",43),e.NdJ("click",function(){return n.resetSucursaleDeliverie()}),e.TgZ(204,"i",44),e._UZ(205,"span",30)(206,"span",31),e.qZA()()()()(),e.TgZ(207,"div",45)(208,"div",46)(209,"div",51)(210,"select",85),e.NdJ("ngModelChange",function(a){return n.sucursale_deliverie_id=a}),e.TgZ(211,"option",15),e._uU(212,"Selec. Lugar de entrega"),e.qZA(),e.YNc(213,me,3,2,"ng-container",16),e.qZA()(),e.TgZ(214,"div",73),e.YNc(215,ge,1,1,"textarea",86),e.qZA(),e.TgZ(216,"div",33)(217,"input",87),e.NdJ("ngModelChange",function(a){return n.date_entrega=a}),e.qZA(),e.TgZ(218,"small"),e._uU(219,"Fecha de entrega"),e.qZA()(),e.YNc(220,fe,5,2,"div",66),e.YNc(221,Ee,5,2,"div",66),e.YNc(222,Pe,5,2,"div",66),e.YNc(223,ve,2,1,"div",66),e.YNc(224,Ze,2,1,"div",66),e.YNc(225,be,2,1,"div",66),e.YNc(226,Ae,2,1,"div",66),e.qZA()()(),e.TgZ(227,"div",26)(228,"div",57)(229,"textarea",88),e.NdJ("ngModelChange",function(a){return n.description=a}),e.qZA()(),e.TgZ(230,"div",51)(231,"button",89),e.NdJ("click",function(){return n.save()}),e.TgZ(232,"span",90),e._uU(233," Crear Proforma "),e.qZA()()()()()()()()()),2&o&&(e.xp6(16),e.Oqu(n.TODAY),e.xp6(2),e.Q6J("ngModel",n.method_payment_id),e.xp6(3),e.Q6J("ngForOf",n.method_payments),e.xp6(1),e.Q6J("ngIf",n.METHOD_PAYMENT_SELECTED&&n.METHOD_PAYMENT_SELECTED.bancos.length>0),e.xp6(2),e.Q6J("ngModel",n.amount_payment),e.xp6(5),e.Q6J("ngIf",n.imagen_previzualiza),e.xp6(1),e.Q6J("ngIf",e.lcZ(31,46,n.isLoading$)),e.xp6(13),e.hij(" ",n.CLIENT_SELECTED?n.CLIENT_SELECTED.client_segment.name:"NO HA SELECCIONADO UN CLIENTE",""),e.xp6(24),e.Q6J("ngModel",n.n_document),e.xp6(2),e.Q6J("ngModel",n.full_name),e.xp6(2),e.Q6J("ngModel",n.phone),e.xp6(13),e.Oqu(n.PRODUCT_SELECTED?n.PRODUCT_SELECTED.product_categorie.name:"NO HAY UN PRODUCTO SELECCIONADO"),e.xp6(23),e.Q6J("ngModel",n.search_product),e.xp6(2),e.Q6J("ngModel",n.price),e.xp6(4),e.Q6J("ngModel",n.quantity_product),e.xp6(4),e.Q6J("ngIf",!n.loadUnidad),e.xp6(2),e.Q6J("ngModel",n.almacen_product),e.xp6(3),e.Q6J("ngForOf",n.warehouses_product),e.xp6(2),e.Q6J("ngModel",n.description_product),e.xp6(1),e.Q6J("ngIf",n.PRODUCT_SELECTED&&2==n.PRODUCT_SELECTED.is_gift),e.xp6(2),e.Q6J("ngIf",n.unidad_product&&0==n.warehouses_product.length),e.xp6(2),e.Q6J("ngIf",n.unidad_product&&n.warehouses_product.length>0&&0==n.exits_warehouse.length),e.xp6(1),e.Q6J("ngIf",n.message_disponibilidad),e.xp6(2),e.Q6J("ngIf",n.PRODUCT_SELECTED&&2==n.PRODUCT_SELECTED.is_discount),e.xp6(5),e.Q6J("ngIf",n.PRODUCT_SELECTED),e.xp6(1),e.Q6J("ngIf",!n.PRODUCT_SELECTED),e.xp6(3),e.hij(" Subtotal: ",n.price-n.amount_discount," PEN "),e.xp6(1),e.Q6J("ngIf",n.PRODUCT_SELECTED),e.xp6(1),e.Q6J("ngIf",!n.PRODUCT_SELECTED),e.xp6(33),e.Q6J("ngForOf",n.DETAIL_PROFORMAS),e.xp6(6),e.hij(" ",n.TOTAL_PROFORMA," "),e.xp6(3),e.hij(" Impuesto: ",n.TOTAL_IMPUESTO_PROFORMA," PEN "),e.xp6(2),e.hij(" Deuda: ",n.DEBT_PROFORMA-(n.amount_payment?n.amount_payment:0)," PEN "),e.xp6(2),e.hij(" Pagado: ",n.PAID_OUT_PROFORMA+(n.amount_payment?n.amount_payment:0)," PEN "),e.xp6(21),e.Q6J("ngModel",n.sucursale_deliverie_id),e.xp6(3),e.Q6J("ngForOf",n.sucursale_deliveries),e.xp6(2),e.Q6J("ngIf",5==n.sucursale_deliverie_id||6==n.sucursale_deliverie_id),e.xp6(2),e.Q6J("ngModel",n.date_entrega),e.xp6(3),e.Q6J("ngIf",6==n.sucursale_deliverie_id),e.xp6(1),e.Q6J("ngIf",6==n.sucursale_deliverie_id),e.xp6(1),e.Q6J("ngIf",6==n.sucursale_deliverie_id),e.xp6(1),e.Q6J("ngIf",5!=n.sucursale_deliverie_id&&n.validationDeliverie()),e.xp6(1),e.Q6J("ngIf",5!=n.sucursale_deliverie_id&&n.validationDeliverie()),e.xp6(1),e.Q6J("ngIf",5!=n.sucursale_deliverie_id&&n.validationDeliverie()),e.xp6(1),e.Q6J("ngIf",5!=n.sucursale_deliverie_id&&n.validationDeliverie()),e.xp6(3),e.Q6J("ngModel",n.description))},dependencies:[u.sg,u.O5,c._Y,c.YN,c.Kr,c.Fj,c.wV,c.EJ,c.JJ,c.JL,c.On,c.F,m._L,u.Ov]})}return i})();function Oe(i,s){1&i&&e._UZ(0,"span",15)}let Le=(()=>{class i{modal;proformaService;toast;ProformasD=new e.vpe;proforma_selected;isLoading;constructor(t,o,n){this.modal=t,this.proformaService=o,this.toast=n}ngOnInit(){}delete(){this.proformaService.deleteProforma(this.proforma_selected.id).subscribe(t=>{console.log(t),403==t.message?this.toast.error("Validaci\xf3n",t.message_text):(this.toast.success("Exito","La proforma se elimino correctamente"),this.ProformasD.emit(t.message),this.modal.close())})}static \u0275fac=function(o){return new(o||i)(e.Y36(m.Kz),e.Y36(D),e.Y36(P._W))};static \u0275cmp=e.Xpm({type:i,selectors:[["app-delete-proforma"]],inputs:{proforma_selected:"proforma_selected"},outputs:{ProformasD:"ProformasD"},decls:21,vars:4,consts:[[1,"modal-content"],["id","kt_modal_add_user_header",1,"modal-header"],[1,"fw-bolder"],["data-kt-users-modal-action","close",1,"btn","btn-icon","btn-sm","btn-active-icon-primary",3,"click"],[1,"svg-icon","svg-icon-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none"],["opacity","0.5","x","6","y","17.3137","width","16","height","2","rx","1","transform","rotate(-45 6 17.3137)","fill","currentColor"],["x","7.41422","y","6","width","16","height","2","rx","1","transform","rotate(45 7.41422 6)","fill","currentColor"],[1,"modal-body","scroll-y","mx-5","mx-xl-15","my-7"],["id","kt_modal_add_user_form","action","#",1,"form"],[1,"text-center","pt-15"],["type","reset",1,"btn","btn-light","me-3",3,"click"],["type","button","data-kt-users-modal-action","submit",1,"btn","btn-danger",3,"click"],[1,"indicator-label"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e.NdJ("click",function(){return n.modal.dismiss()}),e.TgZ(5,"span",4),e.O4$(),e.TgZ(6,"svg",5),e._UZ(7,"rect",6)(8,"rect",7),e.qZA()()()(),e.kcU(),e.TgZ(9,"div",8)(10,"form",9)(11,"p"),e._uU(12," \xbfESTAS SEGURO DE ELIMINAR ESTA PROFORMA? "),e.qZA(),e.TgZ(13,"div",10)(14,"button",11),e.NdJ("click",function(){return n.modal.dismiss()}),e._uU(15,"Cerrar"),e.qZA(),e.TgZ(16,"button",12),e.NdJ("click",function(){return n.delete()}),e.TgZ(17,"span",13),e._uU(18,"ELIMINAR"),e.qZA(),e.YNc(19,Oe,1,0,"span",14),e.ALo(20,"async"),e.qZA()()()()()),2&o&&(e.xp6(3),e.hij("Delete Proforma : #",n.proforma_selected.id,""),e.xp6(16),e.Q6J("ngIf",e.lcZ(20,2,n.isLoading)))},dependencies:[u.O5,c._Y,c.JL,c.F,u.Ov]})}return i})();var xe=l(459);function Me(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",49),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function Se(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",49),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function Ue(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",49),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.full_name)}}function Re(i,s){1&i&&(e.TgZ(0,"a",50),e._uU(1," + Add Proforma "),e.qZA())}function Ie(i,s){1&i&&e._UZ(0,"span",51)}function Ne(i,s){1&i&&(e.TgZ(0,"span",69),e._uU(1,"Cotizaci\xf3n"),e.qZA())}function qe(i,s){1&i&&(e.TgZ(0,"span",70),e._uU(1,"Contrato"),e.qZA())}function ye(i,s){1&i&&(e.TgZ(0,"span",70),e._uU(1,"Pendiente"),e.qZA())}function ke(i,s){1&i&&(e.TgZ(0,"span",71),e._uU(1,"Parcial"),e.qZA())}function Je(i,s){1&i&&(e.TgZ(0,"span",72),e._uU(1,"Total"),e.qZA())}function we(i,s){if(1&i&&(e.TgZ(0,"a",73)(1,"i",74),e._UZ(2,"span",7)(3,"span",8),e.qZA()()),2&i){const t=e.oxw().$implicit;e.Q6J("routerLink","/proformas/listado/edicion/"+t.id)}}function Fe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"a",75),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,r=e.oxw();return e.KtG(r.deleteProforma(n))}),e.TgZ(1,"i",76),e._UZ(2,"span",7)(3,"span",8)(4,"span",63)(5,"span",64)(6,"span",65),e.qZA()()}}function Qe(i,s){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"tr")(2,"td"),e._uU(3),e.qZA(),e.TgZ(4,"td")(5,"div",52)(6,"div",53)(7,"a",54),e._uU(8),e.qZA(),e.TgZ(9,"span",55),e._uU(10),e.qZA()()()(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e.YNc(16,Ne,2,0,"span",56),e.YNc(17,qe,2,0,"span",57),e.qZA(),e.TgZ(18,"td"),e.YNc(19,ye,2,0,"span",57),e.YNc(20,ke,2,0,"span",58),e.YNc(21,Je,2,0,"span",59),e.qZA(),e.TgZ(22,"td"),e._uU(23),e.qZA(),e.TgZ(24,"td"),e._uU(25),e.qZA(),e.TgZ(26,"td"),e._uU(27),e.qZA(),e.TgZ(28,"td"),e._uU(29),e.qZA(),e.TgZ(30,"td",60)(31,"a",61),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.proformaPdf(r))}),e.TgZ(32,"i",62),e._UZ(33,"span",7)(34,"span",8)(35,"span",63)(36,"span",64)(37,"span",65),e.qZA()(),e.TgZ(38,"a",66),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.openProforma(r))}),e.TgZ(39,"i",32),e._UZ(40,"span",7)(41,"span",8)(42,"span",63)(43,"span",64)(44,"span",65),e.qZA()(),e.YNc(45,we,4,1,"a",67),e.YNc(46,Fe,7,0,"a",68),e.qZA()(),e.BQk()}if(2&i){const t=s.$implicit,o=e.oxw();e.xp6(3),e.hij(" ",t.id," "),e.xp6(5),e.Oqu(t.client.full_name),e.xp6(2),e.hij("Tipo: ",1==t.client.type?"PERSONA":"EMPRESA",""),e.xp6(2),e.hij(" ",t.client_segment.name," "),e.xp6(2),e.hij(" ",t.total," PEN "),e.xp6(2),e.Q6J("ngIf",1==t.state_proforma),e.xp6(1),e.Q6J("ngIf",2==t.state_proforma),e.xp6(2),e.Q6J("ngIf",1==t.state_payment),e.xp6(1),e.Q6J("ngIf",2==t.state_payment),e.xp6(1),e.Q6J("ngIf",3==t.state_payment),e.xp6(2),e.hij(" ",t.debt," PEN "),e.xp6(2),e.hij(" ",t.paid_out," PEN "),e.xp6(2),e.hij(" ",t.asesor.full_name," "),e.xp6(2),e.hij(" ",t.created_at," "),e.xp6(16),e.Q6J("ngIf",o.isPermission("edit_proforma")),e.xp6(1),e.Q6J("ngIf",o.isPermission("delete_proforma"))}}const Be=["discount"];function je(i,s){if(1&i&&(e.TgZ(0,"div",85),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.PROFORMA_SELECTED.proforma_deliverie.date_entrega)}}function Ve(i,s){if(1&i&&(e.TgZ(0,"div",85),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.PROFORMA_SELECTED.proforma_deliverie.date_envio)}}function Ge(i,s){if(1&i&&(e.TgZ(0,"div",85),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.PROFORMA_SELECTED.proforma_deliverie.sucursal_deliverie.name)}}function ze(i,s){1&i&&e._UZ(0,"span",86)}function Ke(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",88),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function He(i,s){if(1&i&&(e.ynx(0),e.YNc(1,Ke,3,2,"ng-container",57),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.PRODUCT_SELECTED.units)}}function $e(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"select",87),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.unidad_product=n)})("change",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.changeUnitProduct(n))}),e.TgZ(1,"option",56),e._uU(2,"Selec. Unidad"),e.qZA(),e.YNc(3,He,2,1,"ng-container",66),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.unidad_product),e.xp6(3),e.Q6J("ngIf",t.PRODUCT_SELECTED)}}function We(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",88),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.AsE("",t.warehouse.name," (",t.quantity,")")}}function Xe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",42)(1,"label",11),e._uU(2,"\xbfEs gratuito?"),e.qZA(),e.TgZ(3,"div",89)(4,"input",90),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.isGift())}),e.qZA(),e.TgZ(5,"label",91),e._uU(6,"Costo 0"),e.qZA()()()}}function et(i,s){1&i&&(e.TgZ(0,"span",92),e._uU(1,"No hay de esa unidad disponible en ninguna sucursal"),e.qZA())}function tt(i,s){1&i&&(e.TgZ(0,"span",92),e._uU(1,"No hay de esa unidad disponible en nuestra sucursal"),e.qZA())}function nt(i,s){if(1&i&&(e.TgZ(0,"span",93),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.message_disponibilidad)}}function ot(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",94)(1,"input",95,96),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.amount_discount=n)}),e.qZA(),e.TgZ(3,"small"),e._uU(4,"Descuento del producto"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.amount_discount)}}function it(i,s){if(1&i&&(e.TgZ(0,"span",77),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij(" ",((t.price-t.amount_discount+(t.price-t.amount_discount)*t.PRODUCT_SELECTED.importe_iva*.01)*t.quantity_product).toFixed(2)," ")}}function rt(i,s){1&i&&(e.TgZ(0,"span",77),e._uU(1," 0 "),e.qZA())}function at(i,s){if(1&i&&(e.ynx(0),e._UZ(1,"br"),e._uU(2),e.BQk()),2&i){const t=e.oxw();e.xp6(2),e.hij(" Impuesto: ",(t.price-t.amount_discount)*t.PRODUCT_SELECTED.importe_iva*.01," PEN ")}}function st(i,s){1&i&&(e.ynx(0),e._UZ(1,"br"),e._uU(2," Impuesto: 0 PEN "),e.BQk())}function dt(i,s){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"tr")(2,"td")(3,"a",97),e._uU(4),e.qZA()(),e.TgZ(5,"td")(6,"span",98),e._uU(7),e.qZA()(),e.TgZ(8,"td")(9,"a",99),e._uU(10),e.qZA()(),e.TgZ(11,"td")(12,"a",100),e._uU(13),e.qZA()(),e.TgZ(14,"td",101)(15,"a",99),e._uU(16),e.qZA()(),e.TgZ(17,"td")(18,"a",99),e._uU(19),e.qZA()(),e.TgZ(20,"td",102)(21,"a",103),e.NdJ("click",function(){const n=e.CHM(t),r=n.$implicit,a=n.index,_=e.oxw();return e.KtG(_.editProduct(r,a))}),e.TgZ(22,"i",104),e._UZ(23,"span",21)(24,"span",22),e.qZA()(),e.TgZ(25,"a",105),e.NdJ("click",function(){const n=e.CHM(t),r=n.$implicit,a=n.index,_=e.oxw();return e.KtG(_.deleteProduct(r,a))}),e.TgZ(26,"i",106),e._UZ(27,"span",21)(28,"span",22)(29,"span",31)(30,"span",32)(31,"span",33),e.qZA()()()(),e.BQk()}if(2&i){const t=s.$implicit;e.xp6(4),e.hij(" ",t.product.title," "),e.xp6(3),e.hij("Unidad: ",t.unit.name,""),e.xp6(3),e.hij("",t.price_unit," PEN"),e.xp6(3),e.Oqu(t.quantity),e.xp6(3),e.hij("",t.subtotal," PEN"),e.xp6(3),e.hij("",t.total," PEN")}}function ct(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",88),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function lt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"textarea",107),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.address=n)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("ngModel",t.address)}}function _t(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",88),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function ut(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",42)(1,"select",108),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.ubigeo_region=n)})("change",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.changeRegion(n))}),e.TgZ(2,"option",56),e._uU(3,"Selec. Regi\xf3n"),e.qZA(),e.YNc(4,_t,3,2,"ng-container",57),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.ubigeo_region),e.xp6(3),e.Q6J("ngForOf",t.REGIONES)}}function pt(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",88),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function mt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",42)(1,"select",109),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.ubigeo_provincia=n)})("change",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.changeProvincia(n))}),e.TgZ(2,"option",56),e._uU(3,"Selec. Provincia"),e.qZA(),e.YNc(4,pt,3,2,"ng-container",57),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.ubigeo_provincia),e.xp6(3),e.Q6J("ngForOf",t.PROVINCIA_SELECTEDS)}}function gt(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"option",88),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function ht(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",42)(1,"select",110),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.ubigeo_distrito=n)}),e.TgZ(2,"option",56),e._uU(3,"Selec. Distrito"),e.qZA(),e.YNc(4,gt,3,2,"ng-container",57),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.ubigeo_distrito),e.xp6(3),e.Q6J("ngForOf",t.DISTRITO_SELECTEDS)}}function ft(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",42)(1,"input",111),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.agencia=n)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.agencia)}}function Tt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",42)(1,"input",112),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.full_name_encargado=n)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.full_name_encargado)}}function Et(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",42)(1,"input",113),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.documento_encargado=n)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.documento_encargado)}}function Ct(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",42)(1,"input",114),e.NdJ("ngModelChange",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.telefono_encargado=n)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.telefono_encargado)}}const Pt=[{path:"",component:M,children:[{path:"crear",component:De},{path:"listado",component:(()=>{class i{modalService;proformasService;search="";PROFORMAS=[];isLoading$;totalPages=0;currentPage=1;client_segments=[];asesores=[];client_segment_id="";type="";asesor_id="";search_client="";search_product="";start_date=null;end_date=null;product_categorie_id="";product_categories=[];constructor(t,o){this.modalService=t,this.proformasService=o}ngOnInit(){this.isLoading$=this.proformasService.isLoading$,this.listProformas(),this.configAll()}listProformas(t=1){this.proformasService.listProformas(t,{search:this.search,client_segment_id:this.client_segment_id,asesor_id:this.asesor_id,product_categorie_id:this.product_categorie_id,search_client:this.search_client,search_product:this.search_product,start_date:this.start_date,end_date:this.end_date,state_proforma:this.type}).subscribe(n=>{console.log(n),this.PROFORMAS=n.proformas.data,this.totalPages=n.total,this.currentPage=t})}resetlistProformas(){this.search="",this.client_segment_id="",this.type="",this.asesor_id="",this.product_categorie_id="",this.search_client="",this.search_product="",this.start_date="",this.end_date="",this.type="",this.listProformas()}configAll(){this.proformasService.configAll().subscribe(t=>{console.log(t),this.client_segments=t.client_segments,this.asesores=t.asesores,this.product_categories=t.product_categories})}loadPage(t){this.listProformas(t)}deleteProforma(t){const o=this.modalService.open(Le,{centered:!0,size:"md"});o.componentInstance.proforma_selected=t,o.componentInstance.ProformasD.subscribe(n=>{let r=this.PROFORMAS.findIndex(a=>a.id==t.id);-1!=r&&this.PROFORMAS.splice(r,1)})}openProforma(t){this.modalService.open(xe.R,{centered:!0,size:"lg"}).componentInstance.PROFORMA=t}proformaPdf(t){window.open(h.$g+"/pdf/proforma/"+t.id,"_blank")}exportProformas(){let t="";this.search&&(t+="&search="+this.search),this.client_segment_id&&(t+="&client_segment_id="+this.client_segment_id),this.product_categorie_id&&(t+="&product_categorie_id="+this.product_categorie_id),this.search_client&&(t+="&search_client="+this.search_client),this.type&&(t+="&state_proforma="+this.type),this.search_product&&(t+="&search_product="+this.search_product),this.start_date&&this.end_date&&(t+="&start_date="+this.start_date,t+="&end_date="+this.end_date),this.asesor_id&&(t+="&asesor_id="+this.asesor_id),window.open(h.$g+"/excel/export-proforma-generales?z=1"+t,"_blank")}exportProformasDetails(){let t="";this.search&&(t+="&search="+this.search),this.client_segment_id&&(t+="&client_segment_id="+this.client_segment_id),this.product_categorie_id&&(t+="&product_categorie_id="+this.product_categorie_id),this.search_client&&(t+="&search_client="+this.search_client),this.type&&(t+="&state_proforma="+this.type),this.search_product&&(t+="&search_product="+this.search_product),this.start_date&&this.end_date&&(t+="&start_date="+this.start_date,t+="&end_date="+this.end_date),this.asesor_id&&(t+="&asesor_id="+this.asesor_id),window.open(h.$g+"/excel/export-proforma-details?z=1"+t,"_blank")}isPermission(t){return(0,h.me)(t)}static \u0275fac=function(o){return new(o||i)(e.Y36(m.FF),e.Y36(D))};static \u0275cmp=e.Xpm({type:i,selectors:[["app-list-proformas"]],decls:137,vars:22,consts:[[1,"card"],[1,"card-header","border-0","pt-6"],[1,"card-title"],[1,"row","align-items-center"],[1,"col-2"],[1,"d-flex","align-items-center","position-relative","my-1"],[1,"ki-duotone","ki-magnifier","fs-3","position-absolute","ms-5"],[1,"path1"],[1,"path2"],["type","text","name","search","data-kt-customer-table-filter","search","placeholder","(N\xb0) Proforma ",1,"form-control","form-control-solid","ps-12",3,"ngModel","ngModelChange","keyup.enter"],["name","client_segment_id","placeholder","Selec. Segment",1,"form-control",3,"ngModel","ngModelChange"],["value",""],[4,"ngFor","ngForOf"],[1,"text-muted","fs-7"],["name","product_categorie_id","placeholder","Selec. Categoria",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-3"],["type","text","name","search","data-kt-customer-table-filter","search","placeholder","Cliente",1,"form-control","form-control-solid","ps-12",3,"ngModel","ngModelChange","keyup.enter"],["name","asesor_id","placeholder","Selec. Asesores",1,"form-control",3,"ngModel","ngModelChange"],[1,"input-group","input-group-solid"],["type","date",1,"form-control","form-control-lg","form-control-solid",3,"ngModel","ngModelChange"],["type","text","name","search","data-kt-customer-table-filter","search","placeholder","Producto",1,"form-control","form-control-solid","ps-12",3,"ngModel","ngModelChange","keyup.enter"],["name","type","placeholder","Selec. Status",1,"form-control",3,"ngModel","ngModelChange"],["value","1"],["value","2"],[1,"col-3","d-flex"],["placement","top-start","ngbTooltip","Buscar",1,"btn","btn-primary","btn-sm","mx-1",3,"click"],[1,"ki-duotone","ki-magnifier","fs-2"],["placement","top-start","ngbTooltip","Limpiar",1,"btn","btn-dark","btn-sm","mx-1",3,"click"],[1,"ki-duotone","ki-loading","fs-2"],["placement","top-start","ngbTooltip","Exportar proformas generales",1,"btn","btn-success","btn-sm","mx-1",3,"click"],[1,"ki-duotone","ki-folder-down","fs-2"],["placement","top-start","ngbTooltip","Exportar proforma detalle",1,"btn","btn-success","btn-sm","mx-1",3,"click"],[1,"ki-duotone","ki-questionnaire-tablet","fs-2"],["routerLink","/proformas/crear","placement","top-start","ngbTooltip","Crear Proforma","class","btn btn-primary btn-sm",4,"ngIf"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"card-body","pt-0"],["id","kt_customers_table_wrapper",1,"dt-container","dt-bootstrap5","dt-empty-footer"],["id","",1,"table-responsive"],["id","kt_customers_table",1,"table","align-middle","table-row-dashed","fs-6","gy-5","dataTable",2,"width","1199.5px"],["role","row",1,"text-start","text-gray-500","fw-bold","fs-7","text-uppercase","gs-0"],["data-dt-column","1","rowspan","1","colspan","1","aria-label","Customer Name: Activate to sort","tabindex","0",1,"min-w-125px","dt-orderable-asc","dt-orderable-desc"],["role","button",1,"dt-column-title"],[1,"dt-column-order"],["data-dt-column","2","rowspan","1","colspan","1","aria-label","Email: Activate to sort","tabindex","0",1,"min-w-125px","dt-orderable-asc","dt-orderable-desc"],["data-dt-column","5","rowspan","1","colspan","1","aria-label","Created Date: Activate to sort","tabindex","0",1,"min-w-125px","dt-orderable-asc","dt-orderable-desc"],["data-dt-column","6","rowspan","1","colspan","1","aria-label","Actions",1,"text-end","min-w-70px","dt-orderable-none"],[1,"dt-column-title"],[1,"fw-semibold","text-gray-600"],[3,"collectionSize","page","pageSize","rotate","boundaryLinks","pageChange"],[3,"value"],["routerLink","/proformas/crear","placement","top-start","ngbTooltip","Crear Proforma",1,"btn","btn-primary","btn-sm"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"],[1,"d-flex","align-items-center"],[1,"d-flex","justify-content-start","flex-column"],["href","#",1,"text-gray-900","fw-bold","text-hover-primary","mb-1","fs-6"],[1,"text-muted","fw-semibold","text-muted","d-block","fs-7"],["class","badge badge-light-primary",4,"ngIf"],["class","badge badge-light-danger",4,"ngIf"],["class","badge badge-light-warning",4,"ngIf"],["class","badge badge-light-success",4,"ngIf"],[1,"d-flex"],["href","#","onclick","return false;","placement","top-start","ngbTooltip","Descargar en Pdf",1,"btn","btn-icon","btn-bg-danger","btn-active-color-danger","btn-sm",3,"click"],[1,"ki-duotone","ki-paper-clip","fs-2","text-white"],[1,"path3"],[1,"path4"],[1,"path5"],["href","#","onclick","return false;","placement","top-start","ngbTooltip","Abrir Detallado",1,"btn","btn-icon","btn-bg-light","btn-active-color-primary","btn-sm",3,"click"],["target","_blank","placement","top-start","ngbTooltip","Editar Proforma","class","btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1 mx-2",3,"routerLink",4,"ngIf"],["href","#","onclick","return false;","placement","top-start","ngbTooltip","Eliminar un proforma","class","btn btn-icon btn-bg-light btn-active-color-primary btn-sm",3,"click",4,"ngIf"],[1,"badge","badge-light-primary"],[1,"badge","badge-light-danger"],[1,"badge","badge-light-warning"],[1,"badge","badge-light-success"],["target","_blank","placement","top-start","ngbTooltip","Editar Proforma",1,"btn","btn-icon","btn-bg-light","btn-active-color-primary","btn-sm","me-1","mx-2",3,"routerLink"],[1,"ki-duotone","ki-pencil","fs-2"],["href","#","onclick","return false;","placement","top-start","ngbTooltip","Eliminar un proforma",1,"btn","btn-icon","btn-bg-light","btn-active-color-primary","btn-sm",3,"click"],[1,"ki-duotone","ki-trash","fs-2"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"i",6),e._UZ(7,"span",7)(8,"span",8),e.qZA(),e.TgZ(9,"input",9),e.NdJ("ngModelChange",function(a){return n.search=a})("keyup.enter",function(){return n.listProformas()}),e.qZA()()(),e.TgZ(10,"div",4)(11,"select",10),e.NdJ("ngModelChange",function(a){return n.client_segment_id=a}),e.TgZ(12,"option",11),e._uU(13,"Ninguno"),e.qZA(),e.YNc(14,Me,3,2,"ng-container",12),e.qZA(),e.TgZ(15,"div",13),e._uU(16,"Segmento de cliente."),e.qZA()(),e.TgZ(17,"div",4)(18,"select",14),e.NdJ("ngModelChange",function(a){return n.product_categorie_id=a}),e.TgZ(19,"option",11),e._uU(20,"Ninguno"),e.qZA(),e.YNc(21,Se,3,2,"ng-container",12),e.qZA(),e.TgZ(22,"div",13),e._uU(23,"Categoria de producto."),e.qZA()(),e.TgZ(24,"div",15)(25,"div",5)(26,"i",6),e._UZ(27,"span",7)(28,"span",8),e.qZA(),e.TgZ(29,"input",16),e.NdJ("ngModelChange",function(a){return n.search_client=a})("keyup.enter",function(){return n.listProformas()}),e.qZA()()(),e.TgZ(30,"div",15)(31,"select",17),e.NdJ("ngModelChange",function(a){return n.asesor_id=a}),e.TgZ(32,"option",11),e._uU(33,"Ninguno"),e.qZA(),e.YNc(34,Ue,3,2,"ng-container",12),e.qZA(),e.TgZ(35,"div",13),e._uU(36,"Asesores."),e.qZA()(),e.TgZ(37,"div",4)(38,"div",18)(39,"input",19),e.NdJ("ngModelChange",function(a){return n.start_date=a}),e.qZA()(),e.TgZ(40,"div",13),e._uU(41,"Fecha de inicio."),e.qZA()(),e.TgZ(42,"div",4)(43,"div",18)(44,"input",19),e.NdJ("ngModelChange",function(a){return n.end_date=a}),e.qZA()(),e.TgZ(45,"div",13),e._uU(46,"Fecha fin."),e.qZA()(),e.TgZ(47,"div",15)(48,"div",5)(49,"i",6),e._UZ(50,"span",7)(51,"span",8),e.qZA(),e.TgZ(52,"input",20),e.NdJ("ngModelChange",function(a){return n.search_product=a})("keyup.enter",function(){return n.listProformas()}),e.qZA()()(),e.TgZ(53,"div",4)(54,"select",21),e.NdJ("ngModelChange",function(a){return n.type=a}),e.TgZ(55,"option",11),e._uU(56,"Ninguno"),e.qZA(),e.TgZ(57,"option",22),e._uU(58,"Cotizaci\xf3n"),e.qZA(),e.TgZ(59,"option",23),e._uU(60,"Contrato"),e.qZA()(),e.TgZ(61,"div",13),e._uU(62,"Proformas (Contrato/Cotizaci\xf3n)."),e.qZA()(),e.TgZ(63,"div",24)(64,"button",25),e.NdJ("click",function(){return n.listProformas()}),e.TgZ(65,"i",26),e._UZ(66,"span",7)(67,"span",8),e.qZA()(),e.TgZ(68,"button",27),e.NdJ("click",function(){return n.resetlistProformas()}),e.TgZ(69,"i",28),e._UZ(70,"span",7)(71,"span",8),e.qZA()(),e.TgZ(72,"button",29),e.NdJ("click",function(){return n.exportProformas()}),e.TgZ(73,"i",30),e._UZ(74,"span",7)(75,"span",8),e.qZA()(),e.TgZ(76,"button",31),e.NdJ("click",function(){return n.exportProformasDetails()}),e.TgZ(77,"i",32),e._UZ(78,"span",7)(79,"span",8),e.qZA()(),e.YNc(80,Re,2,0,"a",33),e.qZA()()(),e.YNc(81,Ie,1,0,"span",34),e.ALo(82,"async"),e.qZA(),e.TgZ(83,"div",35)(84,"div",36)(85,"div",37)(86,"table",38)(87,"thead")(88,"tr",39)(89,"th",40)(90,"span",41),e._uU(91,"N\xb0 de Proforma"),e.qZA(),e._UZ(92,"span",42),e.qZA(),e.TgZ(93,"th",40)(94,"span",41),e._uU(95,"Datos cliente"),e.qZA(),e._UZ(96,"span",42),e.qZA(),e.TgZ(97,"th",40)(98,"span",41),e._uU(99,"Segmento de cliente"),e.qZA(),e._UZ(100,"span",42),e.qZA(),e.TgZ(101,"th",40)(102,"span",41),e._uU(103,"Total"),e.qZA(),e._UZ(104,"span",42),e.qZA(),e.TgZ(105,"th",40)(106,"span",41),e._uU(107,"Estado de la proforma"),e.qZA(),e._UZ(108,"span",42),e.qZA(),e.TgZ(109,"th",40)(110,"span",41),e._uU(111,"Estado de pago"),e.qZA(),e._UZ(112,"span",42),e.qZA(),e.TgZ(113,"th",40)(114,"span",41),e._uU(115,"Adeudo"),e.qZA(),e._UZ(116,"span",42),e.qZA(),e.TgZ(117,"th",43)(118,"span",41),e._uU(119,"Pagado"),e.qZA(),e._UZ(120,"span",42),e.qZA(),e.TgZ(121,"th",44)(122,"span",41),e._uU(123,"Asesor"),e.qZA(),e._UZ(124,"span",42),e.qZA(),e.TgZ(125,"th",44)(126,"span",41),e._uU(127,"Fecha de registro"),e.qZA(),e._UZ(128,"span",42),e.qZA(),e.TgZ(129,"th",45)(130,"span",46),e._uU(131,"Actions"),e.qZA(),e._UZ(132,"span",42),e.qZA()()(),e.TgZ(133,"tbody",47),e.YNc(134,Qe,47,16,"ng-container",12),e.qZA(),e._UZ(135,"tfoot"),e.qZA()(),e.TgZ(136,"ngb-pagination",48),e.NdJ("pageChange",function(a){return n.currentPage=a})("pageChange",function(a){return n.loadPage(a)}),e.qZA()()()()),2&o&&(e.xp6(9),e.Q6J("ngModel",n.search),e.xp6(2),e.Q6J("ngModel",n.client_segment_id),e.xp6(3),e.Q6J("ngForOf",n.client_segments),e.xp6(4),e.Q6J("ngModel",n.product_categorie_id),e.xp6(3),e.Q6J("ngForOf",n.product_categories),e.xp6(8),e.Q6J("ngModel",n.search_client),e.xp6(2),e.Q6J("ngModel",n.asesor_id),e.xp6(3),e.Q6J("ngForOf",n.asesores),e.xp6(5),e.Q6J("ngModel",n.start_date),e.xp6(5),e.Q6J("ngModel",n.end_date),e.xp6(8),e.Q6J("ngModel",n.search_product),e.xp6(2),e.Q6J("ngModel",n.type),e.xp6(26),e.Q6J("ngIf",n.isPermission("register_proforma")),e.xp6(1),e.Q6J("ngIf",e.lcZ(82,20,n.isLoading$)),e.xp6(53),e.Q6J("ngForOf",n.PROFORMAS),e.xp6(2),e.Q6J("collectionSize",n.totalPages)("page",n.currentPage)("pageSize",25)("rotate",!0)("boundaryLinks",!0))},dependencies:[u.sg,u.O5,b.rH,c.YN,c.Kr,c.Fj,c.EJ,c.JJ,c.On,m.N9,m._L,u.Ov]})}return i})()},{path:"listado/edicion/:id",component:(()=>{class i{modalService;proformaService;toast;ActivedRoute;CLIENT_SELECTED;n_document="";full_name="";phone="";search_product="";price=0;description_product="";quantity_product=0;unidad_product="";almacen_product="";PRODUCT_SELECTED;loadUnidad=!1;warehouses_product=[];exits_warehouse=[];amount_discount=0;DETAIL_PROFORMAS=[];description="";agencia="";full_name_encargado="";documento_encargado="";telefono_encargado="";REGIONES=N.c;PROVINCIAS=I.M;DISTRITOS=R.x;PROVINCIA_SELECTEDS=[];DISTRITO_SELECTEDS=[];ubigeo_region="";ubigeo_provincia="";ubigeo_distrito="";region="";provincia="";distrito="";sucursale_deliverie_id="";address="";date_entrega=null;isLoading$;client_segments=[];asesores=[];sucursale_deliveries=[];method_payments=[];user;sucursale_asesor="";method_payment_id="";METHOD_PAYMENT_SELECTED;banco_id="";amount_payment=0;payment_file;imagen_previzualiza="";TOTAL_PROFORMA=0;TOTAL_IMPUESTO_PROFORMA=0;DEBT_PROFORMA=0;PAID_OUT_PROFORMA=0;TODAY="Y/m/d";source;something;PROFORMA_ID="";PROFORMA_SELECTED;is_gift=1;eval_disponibilidad=!0;message_disponibilidad="";constructor(t,o,n,r){this.modalService=t,this.proformaService=o,this.toast=n,this.ActivedRoute=r}ngOnInit(){this.isLoading$=this.proformaService.isLoading$,this.user=this.proformaService.authservice.user,this.sucursale_asesor=this.user.sucursale_id,this.ActivedRoute.params.subscribe(t=>{console.log(t),this.PROFORMA_ID=t.id}),this.proformaService.showProforma(this.PROFORMA_ID).subscribe(t=>{console.log(t),this.PROFORMA_SELECTED=t.proforma,this.CLIENT_SELECTED=this.PROFORMA_SELECTED.client,this.n_document=this.CLIENT_SELECTED.n_document,this.full_name=this.CLIENT_SELECTED.full_name,this.phone=this.CLIENT_SELECTED.phone,this.DETAIL_PROFORMAS=this.PROFORMA_SELECTED.details,this.sucursale_deliverie_id=this.PROFORMA_SELECTED.proforma_deliverie.sucursale_deliverie_id,this.date_entrega=this.PROFORMA_SELECTED.proforma_deliverie.date_entrega,this.address=this.PROFORMA_SELECTED.proforma_deliverie.address,this.ubigeo_region=this.PROFORMA_SELECTED.proforma_deliverie.ubigeo_region,this.ubigeo_provincia=this.PROFORMA_SELECTED.proforma_deliverie.ubigeo_provincia,this.ubigeo_distrito=this.PROFORMA_SELECTED.proforma_deliverie.ubigeo_distrito,this.region=this.PROFORMA_SELECTED.proforma_deliverie.region,this.provincia=this.PROFORMA_SELECTED.proforma_deliverie.provincia,this.distrito=this.PROFORMA_SELECTED.proforma_deliverie.distrito,this.changeRegion({target:{value:this.ubigeo_region}}),this.changeProvincia({target:{value:this.ubigeo_provincia}}),this.agencia=this.PROFORMA_SELECTED.proforma_deliverie.agencia,this.full_name_encargado=this.PROFORMA_SELECTED.proforma_deliverie.full_name_encargado,this.documento_encargado=this.PROFORMA_SELECTED.proforma_deliverie.documento_encargado,this.telefono_encargado=this.PROFORMA_SELECTED.proforma_deliverie.telefono_encargado,this.TOTAL_PROFORMA=this.PROFORMA_SELECTED.total,this.TOTAL_IMPUESTO_PROFORMA=this.PROFORMA_SELECTED.igv,this.DEBT_PROFORMA=this.PROFORMA_SELECTED.debt,this.amount_payment=this.PROFORMA_SELECTED.paid_out}),this.proformaService.configAll().subscribe(t=>{console.log(t),this.client_segments=t.client_segments,this.asesores=t.asesores,this.sucursale_deliveries=t.sucursale_deliveries,this.method_payments=t.method_payments,this.TODAY=t.today})}initKeyUpDiscount(){this.source=(0,T.R)(this.something.nativeElement,"keyup"),this.source.pipe((0,C.b)(1200)).subscribe(t=>{console.log(t),this.verifiedDiscount(),this.isLoadingProcess()})}isLoadingProcess(){this.proformaService.isLoadingSubject.next(!0),setTimeout(()=>{this.proformaService.isLoadingSubject.next(!1)},50)}searchClients(){this.n_document||this.full_name||this.phone?this.proformaService.searchClients(this.n_document,this.full_name,this.phone).subscribe(t=>{console.log(t),t.clients.length>1?this.openSelectedClients(t.clients):1==t.clients.length?(this.CLIENT_SELECTED=t.clients[0],this.n_document=this.CLIENT_SELECTED.n_document,this.full_name=this.CLIENT_SELECTED.full_name,this.phone=this.CLIENT_SELECTED.phone,this.toast.success("Exito","Se selecciono al cliente de la proforma"),this.isLoadingProcess()):this.toast.error("Validaci\xf3n","No hay coincidencia en la busqueda")}):this.toast.error("Validaci\xf3n","Necesitas ingresar al menos uno de los campos")}openSelectedClients(t=[]){const o=this.modalService.open(x.M,{size:"lg",centered:!0});o.componentInstance.clients=t,o.componentInstance.ClientSelected.subscribe(n=>{this.CLIENT_SELECTED=n,this.n_document=this.CLIENT_SELECTED.n_document,this.full_name=this.CLIENT_SELECTED.full_name,this.phone=this.CLIENT_SELECTED.phone,this.isLoadingProcess(),this.toast.success("Exito","Se selecciono al cliente de la proforma")})}createClientPerson(){const t=this.modalService.open(O.q,{size:"lg",centered:!0});t.componentInstance.client_segments=this.client_segments,t.componentInstance.asesores=this.asesores,t.componentInstance.ClientsC.subscribe(o=>{this.CLIENT_SELECTED=o,this.n_document=this.CLIENT_SELECTED.n_document,this.full_name=this.CLIENT_SELECTED.full_name,this.phone=this.CLIENT_SELECTED.phone,this.isLoadingProcess()})}createClientCompany(){const t=this.modalService.open(A.P,{size:"lg",centered:!0});t.componentInstance.client_segments=this.client_segments,t.componentInstance.asesores=this.asesores,t.componentInstance.ClientsC.subscribe(o=>{this.CLIENT_SELECTED=o,this.n_document=this.CLIENT_SELECTED.n_document,this.full_name=this.CLIENT_SELECTED.full_name,this.phone=this.CLIENT_SELECTED.phone,this.isLoadingProcess()})}resetClient(){this.CLIENT_SELECTED=null,this.n_document="",this.full_name="",this.phone="",this.isLoadingProcess()}searchProducts(){this.search_product?this.proformaService.searchProducts(this.search_product).subscribe(t=>{console.log(t),t.products.data.length>1?this.openSelectedProduct(t.products.data):1==t.products.data.length?(this.PRODUCT_SELECTED=t.products.data[0],this.search_product=this.PRODUCT_SELECTED.title,setTimeout(()=>{this.initKeyUpDiscount()},50),this.toast.success("Exito","Se selecciono al producto para la proforma"),this.isLoadingProcess()):this.toast.error("Validaci\xf3n","No hay coincidencia en la busqueda")}):this.toast.error("Validaci\xf3n","Necesitas ingresar al menos uno de los campos")}openSelectedProduct(t=[]){const o=this.modalService.open(E.T,{size:"lg",centered:!0});o.componentInstance.products=t,o.componentInstance.ProductSelected.subscribe(n=>{this.PRODUCT_SELECTED=n,this.search_product=this.PRODUCT_SELECTED.title,setTimeout(()=>{this.initKeyUpDiscount()},50),this.isLoadingProcess(),this.toast.success("Exito","Se selecciono el producto para la proforma")})}changeUnitProduct(t){if(console.log(t.target.value),!this.CLIENT_SELECTED)return this.loadUnidad=!0,this.unidad_product="",setTimeout(()=>{this.loadUnidad=!1},50),this.toast.error("Validaci\xf3n","Es necesario seleccionar a un cliente"),void this.isLoadingProcess();let o=t.target.value;this.warehouses_product=this.PRODUCT_SELECTED.warehouses.filter(d=>d.unit.id==o),this.exits_warehouse=this.warehouses_product.filter(d=>d.warehouse.sucursale_id==this.sucursale_asesor);let n=this.PRODUCT_SELECTED.wallets,r=n.filter(d=>d.unit&&d.sucursale&&d.client_segment),a=r.find(d=>d.unit.id==o&&d.sucursale.id==this.sucursale_asesor&&d.client_segment.id==this.CLIENT_SELECTED.client_segment.id);if(a)return void(this.price=a.price_general);r=n.filter(d=>d.unit&&d.sucursale&&!d.client_segment);let _=r.find(d=>d.unit.id==o&&d.sucursale.id==this.sucursale_asesor&&null==d.client_segment);r=n.filter(d=>d.unit&&!d.sucursale&&d.client_segment);let p=r.find(d=>d.unit.id==o&&null==d.sucursale&&d.client_segment.id==this.CLIENT_SELECTED.client_segment.id);if(_&&p)return void(this.price=_.price_general<p.price_general?_.price_general:p.price_general);if(_)return void(this.price=_.price_general);if(p)return void(this.price=p.price_general);let Z=n.find(d=>d.unit.id==o&&null==d.sucursale&&null==d.client_segment);this.price=Z?Z.price_general:this.PRODUCT_SELECTED.price_general}verifiedDiscount(){return console.log(this.amount_discount),this.amount_discount>.01*this.PRODUCT_SELECTED.max_discount*this.price?(this.toast.error("VALIDACI\xd3N","EL DESCUENTO SUPERA EL MONTO QUE TIENE CONFIGURADO"),void(this.amount_discount=0)):this.amount_discount<.01*this.PRODUCT_SELECTED.min_discount*this.price?(this.toast.error("VALIDACI\xd3N","EL DESCUENTO NO SUPERA EL MONTO QUE TIENE CONFIGURADO"),void(this.amount_discount=0)):void 0}isGift(){this.is_gift=1==this.is_gift?2:1,2==this.is_gift&&(this.price=0)}addProduct(){if(!this.PRODUCT_SELECTED)return void this.toast.error("Validaci\xf3n","No hay seleccionado un producto");if(1==this.is_gift&&0==this.price)return void this.toast.error("Validaci\xf3n","No hay precio del producto");if(0==this.quantity_product)return void this.toast.error("Validaci\xf3n","No hay cantidad solicitada del producto");if(!this.unidad_product)return void this.toast.error("Validaci\xf3n","No hay unidad del producto");if(this.PRODUCT_SELECTED&&2==this.PRODUCT_SELECTED.disponiblidad&&(this.unidad_product&&0==this.warehouses_product.length||this.unidad_product&&this.warehouses_product.length>0&&0==this.exits_warehouse.length))return void this.toast.error("Validaci\xf3n","El producto no se puede agregar debido a que no hay exitencias disponibles");if(3==this.PRODUCT_SELECTED.disponiblidad&&this.eval_disponibilidad)return void this.proformaService.evalDisponibilidad(this.PRODUCT_SELECTED.id,this.unidad_product,this.quantity_product).subscribe(a=>{console.log(a),this.message_disponibilidad=a.message,this.eval_disponibilidad=!1});let t=this.price-this.amount_discount,o=t*(.01*this.PRODUCT_SELECTED.importe_iva),n=this.PRODUCT_SELECTED.units.find(a=>a.id==this.unidad_product);this.proformaService.addDetailProforma({proforma_id:this.PROFORMA_ID,product:this.PRODUCT_SELECTED,description:this.description_product,unidad_product:this.unidad_product,unit:n,quantity:this.quantity_product,discount:this.amount_discount,price_unit:this.price,subtotal:t,impuesto:o,total:(t+o)*this.quantity_product}).subscribe(a=>{console.log(a),this.DETAIL_PROFORMAS.push(a.detail),this.TOTAL_PROFORMA=a.new_total,this.TOTAL_IMPUESTO_PROFORMA=a.new_impuesto,this.DEBT_PROFORMA=a.new_debt,this.resetProduct()})}resetProduct(){this.PRODUCT_SELECTED=null,this.search_product="",this.price=0,this.quantity_product=0,this.warehouses_product=[],this.amount_discount=0,this.description_product="",this.unidad_product="",this.almacen_product="",this.is_gift=1,this.message_disponibilidad="",this.eval_disponibilidad=!0}sumTotalDetail(){this.TOTAL_PROFORMA=this.DETAIL_PROFORMAS.reduce((t,o)=>t+o.total,0),this.TOTAL_IMPUESTO_PROFORMA=this.DETAIL_PROFORMAS.reduce((t,o)=>t+o.impuesto,0),this.DEBT_PROFORMA=this.TOTAL_PROFORMA,this.isLoadingProcess()}editProduct(t,o){const n=this.modalService.open(S,{size:"md",centered:!0});n.componentInstance.DETAIL_PRODUCT=t,n.componentInstance.sucursale_asesor=this.sucursale_asesor,n.componentInstance.CLIENT_SELECTED=this.CLIENT_SELECTED,n.componentInstance.PROFORMA_ID=this.PROFORMA_ID,n.componentInstance.EditProductProforma.subscribe(r=>{this.TOTAL_PROFORMA=r.new_total,this.TOTAL_IMPUESTO_PROFORMA=r.new_impuesto,this.DEBT_PROFORMA=r.new_debt,this.DETAIL_PROFORMAS[o]=r.detail,this.isLoadingProcess(),this.sumTotalDetail()})}deleteProduct(t,o){const n=this.modalService.open(U,{size:"md",centered:!0});n.componentInstance.DETAIL_PRODUCT=t,n.componentInstance.PROFORMA_ID=this.PROFORMA_ID,n.componentInstance.DeleteProductProforma.subscribe(r=>{this.TOTAL_PROFORMA=r.new_total,this.TOTAL_IMPUESTO_PROFORMA=r.new_impuesto,this.DEBT_PROFORMA=r.new_debt,this.DETAIL_PROFORMAS.splice(o,1),this.isLoadingProcess(),this.sumTotalDetail()})}validationDeliverie(){if(this.sucursale_deliverie_id){let t=this.sucursale_deliveries.find(o=>o.id==this.sucursale_deliverie_id);if(t&&-1!=t.name.indexOf(this.user.sucursale_name))return!1}return!0}changeRegion(t){console.log(t.target.value);let o=t.target.value,n=this.REGIONES.find(a=>a.id==o);n&&(this.region=n.name);let r=this.PROVINCIAS.filter(a=>a.department_id==o);console.log(r),this.PROVINCIA_SELECTEDS=r}changeProvincia(t){console.log(t.target.value);let o=t.target.value,n=this.PROVINCIAS.find(a=>a.id==o);n&&(this.provincia=n.name);let r=this.DISTRITOS.filter(a=>a.province_id==o);console.log(r),this.DISTRITO_SELECTEDS=r}resetSucursaleDeliverie(){this.agencia="",this.full_name_encargado="",this.documento_encargado="",this.telefono_encargado="",this.region="",this.distrito="",this.provincia="",this.ubigeo_region="",this.ubigeo_provincia="",this.ubigeo_distrito="",this.sucursale_deliverie_id="",this.address="",this.date_entrega=null}changeMethodPayment(){this.METHOD_PAYMENT_SELECTED=this.method_payments.find(t=>t.id==this.method_payment_id),this.banco_id=""}processFile(t){if(t.target.files[0].type.indexOf("image")<0)return void this.toast.warning("WARN","El archivo no es una imagen");this.payment_file=t.target.files[0];let o=new FileReader;o.readAsDataURL(this.payment_file),o.onloadend=()=>this.imagen_previzualiza=o.result,this.isLoadingProcess()}changeSucursaleDeliverie(){this.ubigeo_region="",this.region="",this.ubigeo_provincia="",this.provincia="",this.ubigeo_distrito="",this.distrito="",this.agencia="",this.full_name_encargado="",this.documento_encargado="",this.telefono_encargado=""}save(){if(!this.CLIENT_SELECTED)return void this.toast.error("Validaci\xf3n","Necesitas seleccionar un cliente");if(!this.sucursale_deliverie_id)return void this.toast.error("Validaci\xf3n","El lugar de entrega es requerido");if(!this.date_entrega)return void this.toast.error("Validaci\xf3n","La fecha de entrega es requerido");if(this.validationDeliverie()&&5!=this.sucursale_deliverie_id){if(!this.agencia)return void this.toast.error("Validaci\xf3n","La agencia es requerido");if(!this.full_name_encargado)return void this.toast.error("Validaci\xf3n","El nombre del encargado es requerido");if(!this.documento_encargado)return void this.toast.error("Validaci\xf3n","El documento del encargado es requerido");if(!this.telefono_encargado)return void this.toast.error("Validaci\xf3n","El telefono del encargado es requerido")}if(6==this.sucursale_deliverie_id){if(!this.ubigeo_region)return void this.toast.error("Validaci\xf3n","La region es requerido");if(!this.ubigeo_provincia)return void this.toast.error("Validaci\xf3n","La provincia es requerido");if(!this.ubigeo_distrito)return void this.toast.error("Validaci\xf3n","La distrito es requerido")}let t=this.DISTRITOS.find(n=>n.id==this.ubigeo_distrito);t&&(this.distrito=t.name);let o=new FormData;o.append("client_id",this.CLIENT_SELECTED.id),o.append("client_segment_id",this.CLIENT_SELECTED.client_segment.id),o.append("description",this.description),o.append("sucursale_deliverie_id",this.sucursale_deliverie_id),o.append("date_entrega",this.date_entrega),o.append("address",this.address?this.address:""),o.append("agencia",this.agencia?this.agencia:""),o.append("full_name_encargado",this.full_name_encargado?this.full_name_encargado:""),o.append("documento_encargado",this.documento_encargado?this.documento_encargado:""),o.append("telefono_encargado",this.documento_encargado?this.telefono_encargado:""),this.ubigeo_region?(o.append("ubigeo_region",this.ubigeo_region),o.append("region",this.region)):(o.append("ubigeo_region",""),o.append("region","")),this.ubigeo_provincia?(o.append("ubigeo_provincia",this.ubigeo_provincia),o.append("provincia",this.provincia)):(o.append("ubigeo_provincia",""),o.append("provincia","")),this.ubigeo_distrito?(o.append("ubigeo_distrito",this.ubigeo_distrito),o.append("distrito",this.distrito)):(o.append("ubigeo_distrito",""),o.append("distrito","")),this.proformaService.editProforma(this.PROFORMA_ID,o).subscribe(n=>{console.log(n),this.toast.success("Exito","La proforma se edito con exito")},n=>{console.log(n),this.toast.error("Validaci\xf3n","Hubo un error en el servidor, intente nuevamente o acceda a la consola y vea que sucede")})}static \u0275fac=function(o){return new(o||i)(e.Y36(m.FF),e.Y36(D),e.Y36(P._W),e.Y36(b.gz))};static \u0275cmp=e.Xpm({type:i,selectors:[["app-edit-proforma"]],viewQuery:function(o,n){if(1&o&&e.Gf(Be,5),2&o){let r;e.iGM(r=e.CRH())&&(n.something=r.first)}},decls:228,vars:46,consts:[["data-select2-id","select2-data-131-dzps",1,"d-flex","flex-column","flex-column-fluid"],["id","kt_app_content","data-select2-id","select2-data-kt_app_content",1,"app-content","flex-column-fluid"],["id","kt_app_content_container","data-select2-id","select2-data-kt_app_content_container",1,"app-container","container-xxl"],["id","kt_ecommerce_edit_order_form","data-kt-redirect","/metronic8/demo1/apps/ecommerce/sales/listing.html","data-select2-id","select2-data-kt_ecommerce_edit_order_form",1,"form","d-flex","flex-column","flex-lg-row","fv-plugins-bootstrap5","fv-plugins-framework"],["data-select2-id","select2-data-130-y9wa",1,"w-100","flex-lg-row-auto","w-lg-300px","mb-7","me-7","me-lg-10"],["data-select2-id","select2-data-129-w2zd",1,"card","card-flush","py-4"],[1,"card-header"],[1,"card-title"],["data-select2-id","select2-data-128-9mmu",1,"card-body","pt-0"],["data-select2-id","select2-data-127-2qsf",1,"d-flex","flex-column","gap-10"],[1,"fv-row"],[1,"form-label"],["class","fw-bold fs-3",4,"ngIf"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"d-flex","flex-column","flex-lg-row-fluid","gap-7","gap-lg-10"],[1,"card","card-flush","py-4"],[1,"card-header",2,"display","block"],[1,"row","justify-content-between"],[1,"col-6","d-flex","align-items-center"],[1,"d-flex","align-items-center"],[1,"ki-duotone","ki-user","fs-2tx"],[1,"path1"],[1,"path2"],[1,"mx-2"],[1,"col-4"],["placement","top-start","ngbTooltip","Buscar",1,"btn","btn-sm","mx-1","btn-primary",3,"click"],[1,"ki-duotone","ki-magnifier","fs-2"],["placement","top-start","ngbTooltip","Cliente Persona",1,"btn","btn-sm","mx-1","btn-success",3,"click"],[1,"ki-duotone","ki-user","fs-2"],["placement","top-start","ngbTooltip","Cliente Empresa",1,"btn","btn-sm","mx-1","btn-info",3,"click"],[1,"ki-duotone","ki-delivery-time","fs-2"],[1,"path3"],[1,"path4"],[1,"path5"],["placement","top-start","ngbTooltip","Limpiar",1,"btn","btn-sm","mx-1","btn-dark",3,"click"],[1,"ki-duotone","ki-arrows-circle","fs-2"],[1,"card-body","pt-0"],[1,"row"],["type","text","name","n_document","placeholder"," N\xb0 Documento",1,"form-control","mb-2",3,"ngModel","keyup.enter","ngModelChange"],["type","text","name","full_name","placeholder","Nombre completo",1,"form-control","mb-2",3,"ngModel","keyup.enter","ngModelChange"],["type","text","name","phone","placeholder","Telefono",1,"form-control","mb-2",3,"ngModel","keyup.enter","ngModelChange"],[1,"ki-duotone","ki-delivery-door","fs-2tx"],[1,"col-3"],["placement","top-start","ngbTooltip","Agregar",1,"btn","btn-sm","mx-1","btn-info",3,"click"],[1,"ki-duotone","ki-add-folder","fs-2"],[1,"d-flex","flex-column","gap-10"],["id","kt_ecommerce_edit_order_product_table_wrapper",1,"dt-container","dt-bootstrap5","dt-empty-footer"],["id","",1,"row"],[1,"col-6"],[1,"d-flex","align-items-center","position-relative","mb-n7"],[1,"ki-duotone","ki-magnifier","fs-3","position-absolute","ms-4"],["type","text","data-kt-ecommerce-edit-order-filter","search","placeholder","Buscar Producto","name","search_product",1,"form-control","form-control-solid","w-100","ps-12",3,"ngModel","ngModelChange","keyup.enter"],["type","number","disabled","","name","price","placeholder","Precio",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["type","number","name","quantity_product","placeholder","Cantidad",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["class","form-control form-select-solid fw-bolder","name","unidad_product","placeholder","Selec. Unidad",3,"ngModel","ngModelChange","change",4,"ngIf"],["name","almacen_product","placeholder","Selec. Almacen",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange"],["value",""],[4,"ngFor","ngForOf"],["rows","3","name","description_product","placeholder","Nota",1,"form-control","form-control-solid",3,"ngModel","ngModelChange"],["class","col-3",4,"ngIf"],["class","text-danger",4,"ngIf"],["class","text-info",4,"ngIf"],["class","col-4 mt-1",4,"ngIf"],[1,"separator"],[1,"fw-bold","fs-4"],["id","kt_ecommerce_edit_order_total_price",4,"ngIf"],[4,"ngIf"],[1,"col-5"],[1,"ki-duotone","ki-questionnaire-tablet","text-gray-900","fs-2tx"],[1,"col-12"],[1,"table-responsive"],[1,"table","table-row-bordered","table-row-gray-100","align-middle","gs-0","gy-3"],[1,"fw-bold","text-muted"],[1,"min-w-150px"],[1,"min-w-140px"],[1,"min-w-120px"],[1,"min-w-100px","text-end"],["id","kt_ecommerce_edit_order_total_price"],[1,"ki-duotone","ki-delivery-geolocation","text-gray-900","fs-2tx"],["name","sucursale_deliverie_id","placeholder","Selec. Lugar de entrega",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange","change"],["class","form-control form-control-solid","rows","3","name","address","placeholder","Direcci\xf3n completa",3,"ngModel","ngModelChange",4,"ngIf"],["type","date","name","date_entrega",1,"form-control","form-control-lg","form-control-solid",3,"ngModel","ngModelChange"],["rows","3","name","description","placeholder","Descripci\xf3n general",1,"form-control","form-control-solid","mx-2",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary",3,"click"],[1,"indicator-label"],[1,"fw-bold","fs-3"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"],["name","unidad_product","placeholder","Selec. Unidad",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange","change"],[3,"value"],[1,"form-check","form-check-custom","form-check-solid","mb-2"],["type","checkbox",1,"form-check-input",3,"click"],[1,"form-check-label"],[1,"text-danger"],[1,"text-info"],[1,"col-4","mt-1"],["type","number","name","amount_discount","placeholder","Descuento",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["discount",""],["href","#","onclick","return false;",1,"text-gray-900","fw-bold","text-hover-primary","fs-6"],[1,"text-muted","fw-semibold","text-muted","d-block","fs-7"],["href","#","onclick","return false;",1,"text-gray-900","fw-bold","text-hover-primary","d-block","mb-1","fs-6",2,"text-wrap","nowrap"],["href","#","onclick","return false;",1,"text-gray-900","fw-bold","text-hover-primary","d-block","mb-1","fs-6"],[1,"text-gray-900","fw-bold","text-hover-primary","fs-6"],[1,"text-end"],["href","#","onclick","return false;",1,"btn","btn-icon","btn-bg-light","btn-active-color-primary","btn-sm","me-1",3,"click"],[1,"ki-duotone","ki-pencil","fs-2"],["href","#","onclick","return false",1,"btn","btn-icon","btn-bg-light","btn-active-color-primary","btn-sm",3,"click"],[1,"ki-duotone","ki-trash","fs-2"],["rows","3","name","address","placeholder","Direcci\xf3n completa",1,"form-control","form-control-solid",3,"ngModel","ngModelChange"],["name","ubigeo_region","placeholder","Selec. Regi\xf3n",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange","change"],["name","ubigeo_provincia","placeholder","Selec. Provincia",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange","change"],["name","ubigeo_distrito","placeholder","Selec. Distrito",1,"form-control","form-select-solid","fw-bolder",3,"ngModel","ngModelChange"],["type","text","name","agencia","placeholder"," Agencia de Envio",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["type","text","name","full_name_encargado","placeholder","Nombre del encargado de recojo",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["type","text","name","documento_encargado","placeholder","Documento del encargado de recojo",1,"form-control","mb-2",3,"ngModel","ngModelChange"],["type","text","name","telefono_encargado","placeholder","Telefono del encargado de recojo",1,"form-control","mb-2",3,"ngModel","ngModelChange"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"h2"),e._uU(9),e.qZA()()(),e.TgZ(10,"div",8)(11,"div",9)(12,"div",10)(13,"label",11),e._uU(14,"Fecha de Entrega"),e.qZA(),e.YNc(15,je,2,1,"div",12),e.qZA(),e.TgZ(16,"div",10)(17,"label",11),e._uU(18,"Fecha de Envio"),e.qZA(),e.YNc(19,Ve,2,1,"div",12),e.qZA(),e.TgZ(20,"div",10)(21,"label",11),e._uU(22,"Sede de entrega"),e.qZA(),e.YNc(23,Ge,2,1,"div",12),e.qZA()()()()(),e.YNc(24,ze,1,0,"span",13),e.ALo(25,"async"),e.TgZ(26,"div",14)(27,"div",15)(28,"div",16)(29,"div",17)(30,"div",18)(31,"h2",19)(32,"i",20),e._UZ(33,"span",21)(34,"span",22),e.qZA(),e._uU(35," Cliente : "),e.qZA(),e.TgZ(36,"small",23),e._uU(37),e.qZA()(),e.TgZ(38,"div",24)(39,"button",25),e.NdJ("click",function(){return n.searchClients()}),e.TgZ(40,"i",26),e._UZ(41,"span",21)(42,"span",22),e.qZA()(),e.TgZ(43,"button",27),e.NdJ("click",function(){return n.createClientPerson()}),e.TgZ(44,"i",28),e._UZ(45,"span",21)(46,"span",22),e.qZA()(),e.TgZ(47,"button",29),e.NdJ("click",function(){return n.createClientCompany()}),e.TgZ(48,"i",30),e._UZ(49,"span",21)(50,"span",22)(51,"span",31)(52,"span",32)(53,"span",33),e.qZA()(),e.TgZ(54,"button",34),e.NdJ("click",function(){return n.resetClient()}),e.TgZ(55,"i",35),e._UZ(56,"span",21)(57,"span",22),e.qZA()()()()(),e.TgZ(58,"div",36)(59,"div",37)(60,"div",24)(61,"input",38),e.NdJ("keyup.enter",function(){return n.searchClients()})("ngModelChange",function(a){return n.n_document=a}),e.qZA()(),e.TgZ(62,"div",24)(63,"input",39),e.NdJ("keyup.enter",function(){return n.searchClients()})("ngModelChange",function(a){return n.full_name=a}),e.qZA()(),e.TgZ(64,"div",24)(65,"input",40),e.NdJ("keyup.enter",function(){return n.searchClients()})("ngModelChange",function(a){return n.phone=a}),e.qZA()()()()(),e.TgZ(66,"div",15)(67,"div",16)(68,"div",17)(69,"div",18)(70,"h2",19)(71,"i",41),e._UZ(72,"span",21)(73,"span",22)(74,"span",31)(75,"span",32),e.qZA(),e._uU(76," Producto :"),e.qZA(),e.TgZ(77,"small",23),e._uU(78),e.qZA()(),e.TgZ(79,"div",42)(80,"button",25),e.NdJ("click",function(){return n.searchProducts()}),e.TgZ(81,"i",26),e._UZ(82,"span",21)(83,"span",22),e.qZA()(),e.TgZ(84,"button",34),e.NdJ("click",function(){return n.resetProduct()}),e.TgZ(85,"i",35),e._UZ(86,"span",21)(87,"span",22),e.qZA()(),e.TgZ(88,"button",43),e.NdJ("click",function(){return n.addProduct()}),e.TgZ(89,"i",44),e._UZ(90,"span",21)(91,"span",22),e.qZA()()()()(),e.TgZ(92,"div",36)(93,"div",45)(94,"div",46)(95,"div",47)(96,"div",48)(97,"div",49)(98,"i",50),e._UZ(99,"span",21)(100,"span",22),e.qZA(),e.TgZ(101,"input",51),e.NdJ("ngModelChange",function(a){return n.search_product=a})("keyup.enter",function(){return n.searchProducts()}),e.qZA()()(),e.TgZ(102,"div",42)(103,"input",52),e.NdJ("ngModelChange",function(a){return n.price=a}),e.qZA(),e.TgZ(104,"small"),e._uU(105,"Precio del producto"),e.qZA()(),e.TgZ(106,"div",42)(107,"input",53),e.NdJ("ngModelChange",function(a){return n.quantity_product=a}),e.qZA(),e.TgZ(108,"small"),e._uU(109,"Cantidad del producto"),e.qZA()(),e.TgZ(110,"div",42),e.YNc(111,$e,4,2,"select",54),e.qZA(),e.TgZ(112,"div",42)(113,"select",55),e.NdJ("ngModelChange",function(a){return n.almacen_product=a}),e.TgZ(114,"option",56),e._uU(115,"Selec. Almacen"),e.qZA(),e.YNc(116,We,3,3,"ng-container",57),e.qZA()(),e.TgZ(117,"div",42)(118,"textarea",58),e.NdJ("ngModelChange",function(a){return n.description_product=a}),e.qZA()(),e.YNc(119,Xe,7,0,"div",59),e.TgZ(120,"div",48),e.YNc(121,et,2,0,"span",60),e._UZ(122,"br"),e.YNc(123,tt,2,0,"span",60),e.YNc(124,nt,2,1,"span",61),e._UZ(125,"br"),e.qZA(),e.YNc(126,ot,5,1,"div",62),e.qZA()(),e._UZ(127,"div",63),e.TgZ(128,"div")(129,"div",64),e._uU(130," Costo Total: "),e.YNc(131,it,2,1,"span",65),e.YNc(132,rt,2,0,"span",65),e._uU(133," PEN "),e._UZ(134,"br"),e._uU(135),e.YNc(136,at,3,1,"ng-container",66),e.YNc(137,st,3,0,"ng-container",66),e.qZA()()()()(),e.TgZ(138,"div",15)(139,"div",16)(140,"div",17)(141,"div",67)(142,"h2",19)(143,"i",68),e._UZ(144,"span",21)(145,"span",22),e.qZA(),e._uU(146," Detallado de la proforma : "),e.qZA()(),e._UZ(147,"div",42),e.qZA()(),e.TgZ(148,"div",36)(149,"div",37)(150,"div",69)(151,"div",70)(152,"table",71)(153,"thead")(154,"tr",72)(155,"th",73),e._uU(156,"Producto"),e.qZA(),e.TgZ(157,"th",74),e._uU(158,"Unidad"),e.qZA(),e.TgZ(159,"th",75),e._uU(160,"Precio Unitario"),e.qZA(),e.TgZ(161,"th",75),e._uU(162,"Cantidad"),e.qZA(),e.TgZ(163,"th",75),e._uU(164,"SubTotal"),e.qZA(),e.TgZ(165,"th",75),e._uU(166,"Total"),e.qZA(),e.TgZ(167,"th",76),e._uU(168,"Actions"),e.qZA()()(),e.TgZ(169,"tbody"),e.YNc(170,dt,32,6,"ng-container",57),e.qZA()()()()(),e._UZ(171,"div",63),e.TgZ(172,"div")(173,"div",64),e._uU(174," Total: "),e.TgZ(175,"span",77),e._uU(176),e.qZA(),e._uU(177," PEN "),e._UZ(178,"br"),e._uU(179),e._UZ(180,"br"),e._uU(181),e._UZ(182,"br"),e._uU(183),e.qZA()()()(),e.TgZ(184,"div",15)(185,"div",16)(186,"div",17)(187,"div",24)(188,"h2",19)(189,"i",78),e._UZ(190,"span",21)(191,"span",22)(192,"span",31)(193,"span",32)(194,"span",33),e.qZA(),e._uU(195," Lugar de entrega : "),e.qZA()(),e.TgZ(196,"div",42)(197,"button",34),e.NdJ("click",function(){return n.resetSucursaleDeliverie()}),e.TgZ(198,"i",35),e._UZ(199,"span",21)(200,"span",22),e.qZA()()()()(),e.TgZ(201,"div",36)(202,"div",37)(203,"div",42)(204,"select",79),e.NdJ("ngModelChange",function(a){return n.sucursale_deliverie_id=a})("change",function(){return n.changeSucursaleDeliverie()}),e.TgZ(205,"option",56),e._uU(206,"Selec. Lugar de entrega"),e.qZA(),e.YNc(207,ct,3,2,"ng-container",57),e.qZA()(),e.TgZ(208,"div",67),e.YNc(209,lt,1,1,"textarea",80),e.qZA(),e.TgZ(210,"div",24)(211,"input",81),e.NdJ("ngModelChange",function(a){return n.date_entrega=a}),e.qZA(),e.TgZ(212,"small"),e._uU(213,"Fecha de entrega"),e.qZA()(),e.YNc(214,ut,5,2,"div",59),e.YNc(215,mt,5,2,"div",59),e.YNc(216,ht,5,2,"div",59),e.YNc(217,ft,2,1,"div",59),e.YNc(218,Tt,2,1,"div",59),e.YNc(219,Et,2,1,"div",59),e.YNc(220,Ct,2,1,"div",59),e.qZA()()(),e.TgZ(221,"div",17)(222,"div",48)(223,"textarea",82),e.NdJ("ngModelChange",function(a){return n.description=a}),e.qZA()(),e.TgZ(224,"div",42)(225,"button",83),e.NdJ("click",function(){return n.save()}),e.TgZ(226,"span",84),e._uU(227," Editar Proforma "),e.qZA()()()()()()()()()),2&o&&(e.xp6(9),e.hij("Proforma: #",n.PROFORMA_ID,""),e.xp6(6),e.Q6J("ngIf",n.PROFORMA_SELECTED),e.xp6(4),e.Q6J("ngIf",n.PROFORMA_SELECTED),e.xp6(4),e.Q6J("ngIf",n.PROFORMA_SELECTED),e.xp6(1),e.Q6J("ngIf",e.lcZ(25,44,n.isLoading$)),e.xp6(13),e.hij(" ",n.CLIENT_SELECTED?n.CLIENT_SELECTED.client_segment.name:"NO HA SELECCIONADO UN CLIENTE",""),e.xp6(24),e.Q6J("ngModel",n.n_document),e.xp6(2),e.Q6J("ngModel",n.full_name),e.xp6(2),e.Q6J("ngModel",n.phone),e.xp6(13),e.Oqu(n.PRODUCT_SELECTED?n.PRODUCT_SELECTED.product_categorie.name:"NO HAY UN PRODUCTO SELECCIONADO"),e.xp6(23),e.Q6J("ngModel",n.search_product),e.xp6(2),e.Q6J("ngModel",n.price),e.xp6(4),e.Q6J("ngModel",n.quantity_product),e.xp6(4),e.Q6J("ngIf",!n.loadUnidad),e.xp6(2),e.Q6J("ngModel",n.almacen_product),e.xp6(3),e.Q6J("ngForOf",n.warehouses_product),e.xp6(2),e.Q6J("ngModel",n.description_product),e.xp6(1),e.Q6J("ngIf",n.PRODUCT_SELECTED&&2==n.PRODUCT_SELECTED.is_gift),e.xp6(2),e.Q6J("ngIf",n.unidad_product&&0==n.warehouses_product.length),e.xp6(2),e.Q6J("ngIf",n.unidad_product&&n.warehouses_product.length>0&&0==n.exits_warehouse.length),e.xp6(1),e.Q6J("ngIf",n.message_disponibilidad),e.xp6(2),e.Q6J("ngIf",n.PRODUCT_SELECTED&&2==n.PRODUCT_SELECTED.is_discount),e.xp6(5),e.Q6J("ngIf",n.PRODUCT_SELECTED),e.xp6(1),e.Q6J("ngIf",!n.PRODUCT_SELECTED),e.xp6(3),e.hij(" Subtotal: ",n.price-n.amount_discount," PEN "),e.xp6(1),e.Q6J("ngIf",n.PRODUCT_SELECTED),e.xp6(1),e.Q6J("ngIf",!n.PRODUCT_SELECTED),e.xp6(33),e.Q6J("ngForOf",n.DETAIL_PROFORMAS),e.xp6(6),e.hij(" ",n.TOTAL_PROFORMA," "),e.xp6(3),e.hij(" Impuesto: ",n.TOTAL_IMPUESTO_PROFORMA," PEN "),e.xp6(2),e.hij(" Deuda: ",n.DEBT_PROFORMA-(n.amount_payment?n.amount_payment:0)," PEN "),e.xp6(2),e.hij(" Pagado: ",n.PAID_OUT_PROFORMA+(n.amount_payment?n.amount_payment:0)," PEN "),e.xp6(21),e.Q6J("ngModel",n.sucursale_deliverie_id),e.xp6(3),e.Q6J("ngForOf",n.sucursale_deliveries),e.xp6(2),e.Q6J("ngIf",5==n.sucursale_deliverie_id||6==n.sucursale_deliverie_id),e.xp6(2),e.Q6J("ngModel",n.date_entrega),e.xp6(3),e.Q6J("ngIf",6==n.sucursale_deliverie_id),e.xp6(1),e.Q6J("ngIf",6==n.sucursale_deliverie_id),e.xp6(1),e.Q6J("ngIf",6==n.sucursale_deliverie_id),e.xp6(1),e.Q6J("ngIf",5!=n.sucursale_deliverie_id&&n.validationDeliverie()),e.xp6(1),e.Q6J("ngIf",5!=n.sucursale_deliverie_id&&n.validationDeliverie()),e.xp6(1),e.Q6J("ngIf",5!=n.sucursale_deliverie_id&&n.validationDeliverie()),e.xp6(1),e.Q6J("ngIf",5!=n.sucursale_deliverie_id&&n.validationDeliverie()),e.xp6(3),e.Q6J("ngModel",n.description))},dependencies:[u.sg,u.O5,c._Y,c.YN,c.Kr,c.Fj,c.wV,c.EJ,c.JJ,c.JL,c.On,c.F,m._L,u.Ov]})}return i})()}]}];let vt=(()=>{class i{static \u0275fac=function(o){return new(o||i)};static \u0275mod=e.oAB({type:i});static \u0275inj=e.cJS({imports:[b.Bz.forChild(Pt),b.Bz]})}return i})();var Zt=l(53);let bt=(()=>{class i{static \u0275fac=function(o){return new(o||i)};static \u0275mod=e.oAB({type:i});static \u0275inj=e.cJS({imports:[u.ez,vt,g.JF,c.u5,m.IJ,c.UX,Zt.vi,m.bz,m.jF]})}return i})()},3620:(q,L,l)=>{l.d(L,{b:()=>M});var u=l(6321),b=l(9360),e=l(8251);function M(O,A=u.z){return(0,b.e)((x,E)=>{let T=null,C=null,m=null;const P=()=>{if(T){T.unsubscribe(),T=null;const v=C;C=null,E.next(v)}};function g(){const v=m+O,f=A.now();if(f<v)return T=this.schedule(void 0,v-f),void E.add(T);P()}x.subscribe((0,e.x)(E,v=>{C=v,m=A.now(),T||(T=A.schedule(g,O),E.add(T))},()=>{P(),E.complete()},void 0,()=>{C=T=null}))})}}}]);