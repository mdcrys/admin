"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[953],{1953:(N,_,a)=>{a.r(_),a.d(_,{ProyectoModule:()=>D});var l=a(6814),u=a(7304),e=a(5879),f=a(6021),m=a(9862),C=a(5619),g=a(4716),h=a(6988),P=a(3595);let y=(()=>{class r{http;authservice;isLoading$;isLoadingSubject;constructor(n,t){this.http=n,this.authservice=t,this.isLoadingSubject=new C.X(!1),this.isLoading$=this.isLoadingSubject.asObservable()}registerProyecto(n){this.isLoadingSubject.next(!0);const t=new m.WM({Authorization:"Bearer "+this.authservice.token});return this.http.post(h.$g+"/proyectos",n,{headers:t}).pipe((0,g.x)(()=>this.isLoadingSubject.next(!1)))}listProyectos(n=1,t=""){this.isLoadingSubject.next(!0);const o=new m.WM({Authorization:"Bearer "+this.authservice.token});return this.http.post(h.$g+"/proyectos/index?page="+n,{search:t},{headers:o}).pipe((0,g.x)(()=>this.isLoadingSubject.next(!1)))}updateProyecto(n,t){this.isLoadingSubject.next(!0);const o=new m.WM({Authorization:"Bearer "+this.authservice.token});return this.http.post(h.$g+"/proyectos/"+n,t,{headers:o}).pipe((0,g.x)(()=>this.isLoadingSubject.next(!1)))}deleteProyecto(n){this.isLoadingSubject.next(!0);const t=new m.WM({Authorization:"Bearer "+this.authservice.token});return this.http.delete(h.$g+"/proyectos/"+n,{headers:t}).pipe((0,g.x)(()=>this.isLoadingSubject.next(!1)))}static \u0275fac=function(t){return new(t||r)(e.LFG(m.eN),e.LFG(P.e8))};static \u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var b=a(2425),d=a(1274),c=a(6223);function T(r,p){1&r&&e._UZ(0,"span",19)}let E=(()=>{class r{authService;ProyectoService;toast;modal;nombre="";user;isLoading=!1;ProyectoC=new e.vpe;constructor(n,t,o,i){this.authService=n,this.ProyectoService=t,this.toast=o,this.modal=i}ngOnInit(){this.user=this.authService.user}store(){if(!this.user?.id_empresa)return void this.toast.error("No se encontr\xf3 la empresa del usuario");const n={nombre:this.nombre,id_empresa:this.user.id_empresa};this.isLoading=!0,this.ProyectoService.registerProyecto(n).subscribe({next:t=>{this.toast.success("Proyecto creado correctamente"),this.ProyectoC.emit(t.proyecto),this.modal.close()},error:()=>{this.toast.error("Error al crear el proyecto")},complete:()=>{this.isLoading=!1}})}cerrar(){this.modal.close()}static \u0275fac=function(t){return new(t||r)(e.Y36(f.e),e.Y36(y),e.Y36(b._W),e.Y36(d.Kz))};static \u0275cmp=e.Xpm({type:r,selectors:[["app-create-proyecto"]],outputs:{ProyectoC:"ProyectoC"},decls:23,vars:3,consts:[[1,"modal-content"],["id","kt_modal_add_proyecto_header",1,"modal-header"],[1,"fw-bolder"],["data-kt-users-modal-action","close",1,"btn","btn-icon","btn-sm","btn-active-icon-primary",3,"click"],[1,"svg-icon","svg-icon-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none"],["opacity","0.5","x","6","y","17.3","width","16","height","2","rx","1","transform","rotate(-45 6 17.3)","fill","currentColor"],["x","7.4","y","6","width","16","height","2","rx","1","transform","rotate(45 7.4 6)","fill","currentColor"],[1,"modal-body","scroll-y","mx-5","my-7"],["id","kt_modal_add_proyecto_form","action","#",1,"form"],[1,"card","p-5"],[1,"fv-row","mb-4"],[1,"required","fw-bold","fs-6","mb-2"],["type","text","name","nombre","placeholder","Ej. Sistema de ventas",1,"form-control","form-control-solid",3,"ngModel","ngModelChange"],[1,"text-center","pt-10"],["type","button",1,"btn","btn-light","me-3",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"indicator-label"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),e._uU(3,"Agregar Proyecto"),e.qZA(),e.TgZ(4,"div",3),e.NdJ("click",function(){return o.cerrar()}),e.TgZ(5,"span",4),e.O4$(),e.TgZ(6,"svg",5),e._UZ(7,"rect",6)(8,"rect",7),e.qZA()()()(),e.kcU(),e.TgZ(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11)(13,"label",12),e._uU(14,"Nombre del Proyecto:"),e.qZA(),e.TgZ(15,"input",13),e.NdJ("ngModelChange",function(s){return o.nombre=s}),e.qZA()()(),e.TgZ(16,"div",14)(17,"button",15),e.NdJ("click",function(){return o.cerrar()}),e._uU(18,"Cerrar"),e.qZA(),e.TgZ(19,"button",16),e.NdJ("click",function(){return o.store()}),e.TgZ(20,"span",17),e._uU(21,"Registrar"),e.qZA(),e.YNc(22,T,1,0,"span",18),e.qZA()()()()()),2&t&&(e.xp6(15),e.Q6J("ngModel",o.nombre),e.xp6(4),e.Q6J("disabled",!o.nombre),e.xp6(3),e.Q6J("ngIf",o.isLoading))},dependencies:[l.O5,c._Y,c.Fj,c.JJ,c.JL,c.On,c.F],encapsulation:2})}return r})();function v(r,p){1&r&&e._UZ(0,"span",19)}let Z=(()=>{class r{modal;proyectosService;toast;ProyectoE=new e.vpe;PROYECTO_SELECTED;nombre="";id_empresa=null;estado=1;isLoading=!1;constructor(n,t,o){this.modal=n,this.proyectosService=t,this.toast=o}ngOnInit(){this.PROYECTO_SELECTED&&(this.nombre=this.PROYECTO_SELECTED.nombre,this.id_empresa=this.PROYECTO_SELECTED.id_empresa,this.estado=this.PROYECTO_SELECTED.estado??1,console.log("Proyecto seleccionado:",this.PROYECTO_SELECTED),console.log("id_empresa:",this.id_empresa))}update(){if(!this.nombre.trim())return void this.toast.error("Validaci\xf3n","El nombre es requerido");if(!this.id_empresa)return void this.toast.error("Validaci\xf3n","Debe seleccionar una empresa");this.isLoading=!0;const n=new FormData;n.append("nombre",this.nombre),n.append("id_empresa",this.id_empresa.toString()),n.append("estado",this.estado.toString()),n.append("_method","PUT");const t=this.PROYECTO_SELECTED.id;console.log("Enviando proyecto ID:",t),this.proyectosService.updateProyecto(t,n).subscribe({next:o=>{this.toast.success("\xc9xito","Proyecto actualizado correctamente"),this.ProyectoE.emit(o.proyecto),this.modal.close()},error:o=>{this.toast.error("Error","No se pudo actualizar el proyecto"),this.isLoading=!1},complete:()=>this.isLoading=!1})}static \u0275fac=function(t){return new(t||r)(e.Y36(d.Kz),e.Y36(y),e.Y36(b._W))};static \u0275cmp=e.Xpm({type:r,selectors:[["app-update-proyecto"]],inputs:{PROYECTO_SELECTED:"PROYECTO_SELECTED"},outputs:{ProyectoE:"ProyectoE"},decls:23,vars:3,consts:[[1,"modal-content"],["id","kt_modal_update_proyecto_header",1,"modal-header"],[1,"fw-bolder"],[1,"btn","btn-icon","btn-sm","btn-active-icon-primary",3,"click"],[1,"svg-icon","svg-icon-1"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none"],["opacity","0.5","x","6","y","17.3","width","16","height","2","rx","1","transform","rotate(-45 6 17.3)","fill","currentColor"],["x","7.4","y","6","width","16","height","2","rx","1","transform","rotate(45 7.4 6)","fill","currentColor"],[1,"modal-body","scroll-y","mx-5","my-7"],["id","kt_modal_update_proyecto_form","action","#",1,"form"],[1,"card","p-5"],[1,"fv-row","mb-4"],[1,"required","fw-bold","fs-6","mb-2"],["type","text","name","nombre","placeholder","Ej. Sistema de ventas","required","",1,"form-control","form-control-solid",3,"ngModel","ngModelChange"],[1,"text-center","pt-10"],["type","button",1,"btn","btn-light","me-3",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"indicator-label"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),e._uU(3,"Actualizar Proyecto"),e.qZA(),e.TgZ(4,"div",3),e.NdJ("click",function(){return o.modal.dismiss()}),e.TgZ(5,"span",4),e.O4$(),e.TgZ(6,"svg",5),e._UZ(7,"rect",6)(8,"rect",7),e.qZA()()()(),e.kcU(),e.TgZ(9,"div",8)(10,"form",9)(11,"div",10)(12,"div",11)(13,"label",12),e._uU(14,"Nombre del Proyecto:"),e.qZA(),e.TgZ(15,"input",13),e.NdJ("ngModelChange",function(s){return o.nombre=s}),e.qZA()()(),e.TgZ(16,"div",14)(17,"button",15),e.NdJ("click",function(){return o.modal.dismiss()}),e._uU(18,"Cerrar"),e.qZA(),e.TgZ(19,"button",16),e.NdJ("click",function(){return o.update()}),e.TgZ(20,"span",17),e._uU(21,"Actualizar"),e.qZA(),e.YNc(22,v,1,0,"span",18),e.qZA()()()()()),2&t&&(e.xp6(15),e.Q6J("ngModel",o.nombre),e.xp6(4),e.Q6J("disabled",!o.nombre.trim()),e.xp6(3),e.Q6J("ngIf",o.isLoading))},dependencies:[l.O5,c._Y,c.Fj,c.JJ,c.JL,c.Q7,c.On,c.F]})}return r})();function O(r,p){1&r&&(e.TgZ(0,"span"),e._uU(1,"Eliminar"),e.qZA())}function L(r,p){1&r&&e._UZ(0,"span",9)}let S=(()=>{class r{modal;proyectosService;toast;ProyectoD=new e.vpe;PROYECTO_SELECTED;isLoading=!1;constructor(n,t,o){this.modal=n,this.proyectosService=t,this.toast=o}ngOnInit(){}delete(){this.PROYECTO_SELECTED&&this.PROYECTO_SELECTED.id?(this.isLoading=!0,this.proyectosService.deleteProyecto(this.PROYECTO_SELECTED.id).subscribe({next:()=>{this.toast.success("\xc9xito","El proyecto se elimin\xf3 correctamente"),this.ProyectoD.emit(this.PROYECTO_SELECTED.id),this.modal.close()},error:()=>{this.toast.error("Error","No se pudo eliminar el proyecto"),this.isLoading=!1},complete:()=>this.isLoading=!1})):this.toast.error("Error","No se ha seleccionado un proyecto v\xe1lido")}static \u0275fac=function(t){return new(t||r)(e.Y36(d.Kz),e.Y36(y),e.Y36(b._W))};static \u0275cmp=e.Xpm({type:r,selectors:[["app-delete-proyecto"]],inputs:{PROYECTO_SELECTED:"PROYECTO_SELECTED"},outputs:{ProyectoD:"ProyectoD"},decls:16,vars:4,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-danger",3,"disabled","click"],[4,"ngIf"],["class","spinner-border spinner-border-sm","role","status","aria-hidden","true",4,"ngIf"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"h5",1),e._uU(2,"Eliminar Proyecto"),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return o.modal.dismiss()}),e.qZA()(),e.TgZ(4,"div",3)(5,"p"),e._uU(6,"\xbfEst\xe1s seguro que deseas eliminar el proyecto "),e.TgZ(7,"strong"),e._uU(8),e.qZA(),e._uU(9,"?"),e.qZA()(),e.TgZ(10,"div",4)(11,"button",5),e.NdJ("click",function(){return o.modal.dismiss()}),e._uU(12,"Cancelar"),e.qZA(),e.TgZ(13,"button",6),e.NdJ("click",function(){return o.delete()}),e.YNc(14,O,2,0,"span",7),e.YNc(15,L,1,0,"span",8),e.qZA()()),2&t&&(e.xp6(8),e.Oqu(null==o.PROYECTO_SELECTED?null:o.PROYECTO_SELECTED.nombre),e.xp6(5),e.Q6J("disabled",o.isLoading),e.xp6(1),e.Q6J("ngIf",!o.isLoading),e.xp6(1),e.Q6J("ngIf",o.isLoading))},dependencies:[l.O5]})}return r})();function x(r,p){1&r&&e._UZ(0,"span",15)}function Y(r,p){1&r&&(e.TgZ(0,"span",31),e._uU(1,"Activo"),e.qZA())}function k(r,p){1&r&&(e.TgZ(0,"span",32),e._uU(1,"Inactivo"),e.qZA())}function U(r,p){if(1&r){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",16)(2,"div",17)(3,"div",18)(4,"h4",19),e._uU(5),e.qZA(),e._UZ(6,"input",20),e.TgZ(7,"p",21)(8,"strong"),e._uU(9,"Fecha Registro:"),e.qZA(),e._uU(10),e.ALo(11,"date"),e.qZA(),e.TgZ(12,"p")(13,"strong"),e._uU(14,"Estado:"),e.qZA(),e.YNc(15,Y,2,0,"span",22),e.YNc(16,k,2,0,"span",23),e.qZA()(),e.TgZ(17,"div",24)(18,"div")(19,"button",25),e.NdJ("click",function(){const i=e.CHM(n).$implicit,s=e.oxw();return e.KtG(s.editProyecto(i))}),e._UZ(20,"i",26),e._uU(21," Editar "),e.qZA(),e.TgZ(22,"button",27),e.NdJ("click",function(){const i=e.CHM(n).$implicit,s=e.oxw();return e.KtG(s.deleteProyecto(i))}),e._UZ(23,"i",28),e._uU(24," Eliminar "),e.qZA()(),e.TgZ(25,"button",29),e.NdJ("click",function(){const i=e.CHM(n).$implicit,s=e.oxw();return e.KtG(s.verModuloProyecto(i.id))}),e._UZ(26,"i",30),e.qZA()()()(),e.BQk()}if(2&r){const n=p.$implicit;e.xp6(5),e.Oqu(n.nombre),e.xp6(1),e.Q6J("value",n.id_empresa),e.xp6(4),e.hij(" ",e.xi3(11,5,n.created_at,"dd/MM/yyyy"),""),e.xp6(5),e.Q6J("ngIf",1==n.estado),e.xp6(1),e.Q6J("ngIf",2==n.estado)}}const A=[{path:"",component:(()=>{class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=e.Xpm({type:r,selectors:[["app-proyecto"]],decls:1,vars:0,template:function(t,o){1&t&&e._UZ(0,"router-outlet")},dependencies:[u.lC]})}return r})(),children:[{path:"list",component:(()=>{class r{modalService;proyectoService;router;search="";PROYECTOS=[];isLoading$;totalPages=0;currentPage=1;proyecto;constructor(n,t,o){this.modalService=n,this.proyectoService=t,this.router=o}ngOnInit(){this.isLoading$=this.proyectoService.isLoading$,this.listProyectos(),console.log("Proyecto recibido:",this.proyecto)}listProyectos(n=1){this.proyectoService.listProyectos(n,this.search).subscribe(t=>{this.PROYECTOS=t.proyectos,this.totalPages=t.total,this.currentPage=n})}loadPage(n){this.listProyectos(n)}createProyecto(){this.modalService.open(E,{centered:!0,size:"lg"}).componentInstance.ProyectoC.subscribe(t=>{this.PROYECTOS.unshift(t)})}editProyecto(n){const t=this.modalService.open(Z,{centered:!0,size:"lg"});t.componentInstance.PROYECTO_SELECTED=n,t.componentInstance.ProyectoE.subscribe(o=>{const i=this.PROYECTOS.findIndex(s=>s.id_proyecto===o.id_proyecto);-1!==i&&(this.PROYECTOS[i]=o)})}deleteProyecto(n){const t=this.modalService.open(S,{centered:!0,size:"md"});t.componentInstance.PROYECTO_SELECTED=n,t.componentInstance.ProyectoD.subscribe(()=>{const o=this.PROYECTOS.findIndex(i=>i.id==n.id);-1!=o&&this.PROYECTOS.splice(o,1)})}verModuloProyecto(n){this.router.navigate(["/modulos/list"],{queryParams:{id_proyecto:n}})}static \u0275fac=function(t){return new(t||r)(e.Y36(d.FF),e.Y36(y),e.Y36(u.F0))};static \u0275cmp=e.Xpm({type:r,selectors:[["app-list-proyecto"]],inputs:{proyecto:"proyecto"},decls:17,vars:10,consts:[[1,"card"],[1,"card-header","border-0","pt-6"],[1,"card-title"],[1,"d-flex","align-items-center","position-relative","my-1"],[1,"ki-duotone","ki-magnifier","fs-3","position-absolute","ms-5"],[1,"path1"],[1,"path2"],["type","text","name","search","placeholder","Buscar Proyecto",1,"form-control","form-control-solid","w-250px","ps-12",3,"ngModel","ngModelChange","keyup.enter"],["class","spinner-border spinner-border-sm align-middle ms-2",4,"ngIf"],[1,"card-toolbar"],["type","button",1,"btn","btn-primary",3,"click"],[1,"card-body","pt-4"],[1,"row"],[4,"ngFor","ngForOf"],[3,"collectionSize","page","pageSize","rotate","boundaryLinks","pageChange"],[1,"spinner-border","spinner-border-sm","align-middle","ms-2"],[1,"col-md-4","mb-4"],[1,"card","shadow-sm","h-100"],[1,"card-body","text-center"],[1,"card-title","fw-bold","text-dark","mb-3","fs-2"],["type","hidden",3,"value"],[1,"mb-1"],["class","badge badge-light-success",4,"ngIf"],["class","badge badge-light-danger",4,"ngIf"],[1,"card-footer","d-flex","justify-content-between","gap-2"],[1,"btn","btn-sm","btn-light-primary",3,"click"],[1,"ki-duotone","ki-pencil"],[1,"btn","btn-sm","btn-light-danger",3,"click"],[1,"ki-duotone","ki-trash"],["title","Ver detalle del proyecto",1,"btn","btn-icon","btn-bg-light","btn-active-color-primary","btn-sm",3,"click"],[1,"fas","fa-arrow-right","fs-2"],[1,"badge","badge-light-success"],[1,"badge","badge-light-danger"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"i",4),e._UZ(5,"span",5)(6,"span",6),e.qZA(),e.TgZ(7,"input",7),e.NdJ("ngModelChange",function(s){return o.search=s})("keyup.enter",function(){return o.listProyectos()}),e.qZA()()(),e.YNc(8,x,1,0,"span",8),e.ALo(9,"async"),e.TgZ(10,"div",9)(11,"button",10),e.NdJ("click",function(){return o.createProyecto()}),e._uU(12,"+ Agregar Proyecto"),e.qZA()()(),e.TgZ(13,"div",11)(14,"div",12),e.YNc(15,U,27,8,"ng-container",13),e.qZA(),e.TgZ(16,"ngb-pagination",14),e.NdJ("pageChange",function(s){return o.currentPage=s})("pageChange",function(s){return o.loadPage(s)}),e.qZA()()()),2&t&&(e.xp6(7),e.Q6J("ngModel",o.search),e.xp6(1),e.Q6J("ngIf",e.lcZ(9,8,o.isLoading$)),e.xp6(7),e.Q6J("ngForOf",o.PROYECTOS),e.xp6(1),e.Q6J("collectionSize",o.totalPages)("page",o.currentPage)("pageSize",25)("rotate",!0)("boundaryLinks",!0))},dependencies:[l.sg,l.O5,c.Fj,c.JJ,c.On,d.N9,l.Ov,l.uU]})}return r})()}]}];let J=(()=>{class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=e.oAB({type:r});static \u0275inj=e.cJS({imports:[u.Bz.forChild(A),u.Bz]})}return r})();var R=a(53);let D=(()=>{class r{static \u0275fac=function(t){return new(t||r)};static \u0275mod=e.oAB({type:r});static \u0275inj=e.cJS({imports:[l.ez,J,m.JF,c.u5,d.IJ,c.UX,R.vi,d.bz,d.jF]})}return r})()}}]);